function addressDirective(reference){return{restrict:"AE",scope:{address:"=",updateAddress:"&",deleteAddress:"&",simpleView:"="},templateUrl:"/_core/directives/address.html",link:function(scope){scope.simpleView||(scope.simpleView=!1),scope.$watch("address",function(newVal,oldVal){newVal&&scope.getStates(newVal.country)}),scope.new_address=angular.copy(scope.address),scope.blurTest=function(){scope.hideForm()},reference.initializeReferences().then(function(){scope.countries=reference.countries,scope.address_types=reference.address_types},function(err){$rootScope.errors=err,angular.element("#globalWarning").modal("show")}),scope.getStates=function(country){country&&("United States of America"!=country&&"Canada"!=country?reference.getStatesByCountry(country).then(function(){scope.states=reference.states},function(err){$rootScope.errors=err,angular.element("#globalWarning").modal("show")}):reference.getStates().then(function(){scope.states=reference.states},function(err){$rootScope.errors=err,angular.element("#globalWarning").modal("show")}))},scope.address?scope.getStates(scope.address.country):scope.getStates("United States of America"),scope.validate=function(){},scope.showForm=function(){scope.new_address=angular.copy(scope.address),scope.tabIndex=0,scope.validate(),scope.formVisible=!0},scope.hideForm=function(){scope.new_address=angular.copy(scope.address),scope.tabIndex="",scope.formVisible=!1},scope.submit=function(){angular.forEach(scope.address,function(value,key){scope.address[key]=scope.new_address[key]}),scope.updateAddress(),scope.hideForm()},scope.delete=function(){scope.deleteAddress(scope.address),scope.hideForm()}}}}function contactNameDirective(){return{restrict:"AE",scope:{contact:"=",updateContact:"&",visible:"=",firstNameLabel:"@",lastNameLabel:"@"},transclude:!0,replace:!0,templateUrl:"/_core/directives/contactName.html",link:function(scope,elem,attrs){scope.validate=function(){},scope.showForm=function(){scope.validate(),scope.formVisible=!0},scope.hideForm=function(){scope.formVisible=!1},scope.submit=function(e){scope.updateContact(),scope.formVisible=!1}}}}function fileUploadDirective($filter,Upload,user,$timeout){return{restrict:"AE",scope:{},transclude:!1,templateUrl:"/_core/directives/fileUpload.html",link:function($scope){var uploadUrl="";uploadUrl+="/hotel/927/upload",$scope.uploadPic=function(file){file.upload=Upload.upload({url:uploadUrl,arrayKey:"",data:{researcher_admin_id:3373,event_date:"2016-09-21",raw_image:file}}),file.upload.then(function(response){$timeout(function(){file.result=response.data})},function(response){response.status>0&&($scope.errorMsg=response.status+": "+response.data)},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})},$scope.uploadFiles=function(files){$scope.files=files,files&&files.length&&Upload.upload({url:uploadUrl,arrayKey:"",data:{raw_image:files,researcher_admin_id:3373,event_date:"2016-09-21"}}).then(function(response){$timeout(function(){$scope.result=response.data})},function(response){response.status>0&&($scope.errorMsg=response.status+": "+response.data)},function(evt){$scope.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})}}}}function imagePreviewDirective($rootScope){return{restrict:"AE",scope:{modalInstance:"<",resolve:"<",close:"&",dismiss:"&"},transclude:!1,templateUrl:"/_core/directives/imagePreview.html",link:{pre:function(scope){scope.previewObj=scope.resolve.previewObj},post:function(scope){}}}}function kgDatePickerDirective($filter){return{restrict:"AE",require:"ngModel",scope:{date:"=ngModel",kgClass:"@",changeLimit:"@",dateLabel:"@",dateTitle:"@",onSubmit:"&"},transclude:!1,templateUrl:"/_core/directives/kgDatePickerTemplate.html",link:{pre:function(scope){scope.dateOptions={showWeeks:!1},scope.changeLimit&&scope.date&&(scope.dateOptions.minDate=(new Date).setTime(scope.date.getTime()-864e5*scope.changeLimit),scope.dateOptions.maxDate=(new Date).setTime(scope.date.getTime()+864e5*scope.changeLimit)),scope.$watch("changeLimit",function(newVal){scope.changeLimit=parseInt(newVal)})},post:function(scope,elem,attrs,ngModelController){scope.showHideCal=function(){scope.calPopup=!scope.calPopup},ngModelController.$render=function(){elem.find("input").text(ngModelController.$viewValue)}}}}}function loadingBoxDirective($rootScope,partials){return{restrict:"AE",replace:!0,template:'<div class="loading" ng-show="is_loading"><div class="spinner"><i class="fa fa-circle-o-notch fa-spin fa-5x fa-fw"></i><div class="text">getting ready...</div></div></div>',link:{pre:function(scope){scope.is_loading=$rootScope.is_loading,$rootScope.$watch("is_loading",function(){scope.is_loading=$rootScope.is_loading})}}}}function navBarDirective($rootScope,user,$uibModal,$state){return{restrict:"AE",replace:!0,templateUrl:"/_core/directives/navBarTemplate.html",link:function($scope){$scope.user=user,$scope.user_data=user.user_data,$scope.navbarOpen=!1,$scope.navbarClick=function(){$scope.user_data.admin_user_id||($scope.user_data=user.user_data),$scope.navbarOpen=!$scope.navbarOpen},$rootScope.$watch("errors",function(){$scope.globalWarning=$rootScope.errors,angular.element("#globalWarning").modal("show")}),$scope.navbar_logout=function(){user.logout().then(function(){$scope.navbarOpen=!1,$state.go("login-module")},function(){$scope.navbarOpen=!1,$state.go("login-module")})},$scope.open=function(size){$uibModal.open({animation:$scope.animationsEnabled,templateUrl:"/_core/partials/globalWarning.html",controller:"errorController",size:size,resolve:{errors:function(){return $scope.globalwarning}}})},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}}}function paginationDirective(){return{restrict:"AE",scope:{currentPage:"=",totalPages:"=",changePage:"&"},replace:!0,templateUrl:"/_core/directives/paginationTemplate.html",link:function(scope){function setPages(currentPage,totalPages){scope.Pages=[];var start,end,x=3;currentPage-3>=1?start=currentPage-3:(start=1,x=7-currentPage),currentPage+x<totalPages?end=currentPage+x:(end=totalPages,(start=end-7)<1&&(start=1));for(var i=start;i<=end;i++)scope.Pages.push(i);scope.currentPage=currentPage,scope.totalPages=totalPages}scope.Pages=[],scope.jumpToPage=function(page){scope.changePage({page:page})},scope.$watchGroup(["currentPage","totalPages"],function(newVal,oldVal){setPages(newVal[0],newVal[1])})}}}function contactService($http,$q,group,user,$stateParams,event){var self=this;self.EventCreateContacts=[],self.EventCreateAddress=[],self.newcontact_data={},self.initializeContact=function(group_id,contact_id){return $q(function(resolve,reject){if(self.contact_data&&self.contact_data.contact_id==contact_id)resolve();else{var getGroupData=function(callback){group.initializeGroup(group_id).then(function(){callback(null)},function(err){callback(err)})},getGroupContacts=function(callback){self.getContactById(contact_id).then(function(){callback(null)},function(err){callback(err)})};async.waterfall([getGroupData,getGroupContacts],function(err){err&&reject(err),resolve()})}})},self.getContactById=function(contact_id){return $q(function(resolve,reject){$http.get("/contact/"+contact_id).then(function(res){self.contact_data=res.data.contact,resolve()},function(err){reject(err.data)})})},self.getContactDetails=function(contact_id){return $q(function(resolve,reject){$http.get("/contact/"+contact_id).then(function(res){self.EventCreateContacts.push(res.data.contact),res.data.contact.addresses.length>0&&angular.forEach(res.data.contact.addresses,function(value){self.EventCreateAddress.push({address:value,contact_id:res.data.contact.contact_id,contact_name:res.data.contact.contact_name})}),resolve()},function(err){reject(err.data)})})},self.removeFromEventCreateAddress=function(contact_id){var TempAddress=[];angular.forEach(self.EventCreateAddress,function(value){value.contact_id!=contact_id&&TempAddress.push(value)}),self.EventCreateAddress=TempAddress},self.saveContact=function(newcontact,newcontactemail,newcontactphone,newcontactaddress,flag){return $q(function(resolve,reject){var newContact=function(callback){self.postContact(newcontact).then(function(){callback(null)},function(err){callback(err)})},newContactPhone=function(callback){newcontactphone?(newcontactphone.created_user_id=user.user_data.admin_user_id,newcontactphone.is_hq=!0,self.postContactPhone(newcontactphone,self.newcontact_data.contact_id).then(function(){callback(null)},function(err){callback(err)})):callback(null)},newContactEmail=function(callback){newcontactemail?(newcontactemail.created_user_id=user.user_data.admin_user_id,newcontactemail.is_hq=!0,self.postContactEmail(newcontactemail,self.newcontact_data.contact_id).then(function(){callback(null)},function(err){callback(err)})):callback(null)},newContactAddress=function(callback){newcontactaddress.street_address?(newcontactaddress.created_user_id=user.user_data.admin_user_id,newcontactaddress.is_hq=!0,self.postContactAddress(newcontactaddress,self.newcontact_data.contact_id).then(function(){callback(null)},function(err){callback(err)})):callback(null)},associateEvent=function(callback){flag?event.associateContactWithEvent([$stateParams.event_id],[self.newcontact_data.contact_id]).then(function(){callback(null)},function(err){callback(err)}):callback(null)};async.waterfall([newContact,newContactPhone,newContactEmail,newContactAddress,associateEvent],function(err){err&&reject(err),resolve()})})},self.updateContactAddress=function(contactAddress,contact_id){return $q(function(resolve,reject){contactAddress.updated_user_id=user.user_data.admin_user_id,$http.put("/contact/"+contact_id+"/address/"+contactAddress.address_id,JSON.stringify(contactAddress)).then(function(res){self.contact_data=res.data.contact,resolve()},function(err){reject(err.data)})})},self.updateContactEmail=function(contactEmail,contact_id){return $q(function(resolve,reject){contactEmail.updated_user_id=user.user_data.admin_user_id,$http.put("/contact/"+contact_id+"/email/"+contactEmail.email_id,JSON.stringify(contactEmail)).then(function(res){self.contact_data=res.data.contact,resolve()},function(err){reject(err.data)})})},self.updateContactPhone=function(contactPhone,contact_id){return $q(function(resolve,reject){contactPhone.updated_user_id=user.user_data.admin_user_id,$http.put("/contact/"+contact_id+"/phone/"+contactPhone.phone_id,JSON.stringify(contactPhone)).then(function(res){self.contact_data=res.data.contact,resolve()},function(err){reject(err.data)})})},self.updateContact=function(contact){return $q(function(resolve,reject){contact.updated_user_id=user.user_data.admin_user_id,void 0,$http.put("/contact/"+contact.contact_id,contact).then(function(res){self.contact_data=res.data.contact,resolve()},function(err){reject(err.data)})})},self.postContactAddress=function(newcontactaddress,contact_id){return $q(function(resolve,reject){newcontactaddress.created_user_id=user.user_data.admin_user_id,$http.post("/contact/"+contact_id+"/address",JSON.stringify(newcontactaddress)).then(function(res){self.contact_data=res.data.contact,resolve()},function(err){reject(err.data)})})},self.postContactEmail=function(newcontactemail,contact_id){return $q(function(resolve,reject){newcontactemail.created_user_id=user.user_data.admin_user_id,$http.post("/contact/"+contact_id+"/email",JSON.stringify(newcontactemail)).then(function(res){self.contact_data=res.data.contact,resolve()},function(err){reject(err.data)})})},self.postContactPhone=function(newcontactphone,contact_id){return $q(function(resolve,reject){newcontactphone.created_user_id=user.user_data.admin_user_id,$http.post("/contact/"+contact_id+"/phone",JSON.stringify(newcontactphone)).then(function(res){self.contact_data=res.data.contact,resolve()},function(err){reject(err.data)})})},self.postContact=function(newcontact){return $q(function(resolve,reject){newcontact.group_id=$stateParams.group_id,newcontact.created_user_id=user.user_data.admin_user_id,$http.post("/contact/",newcontact).then(function(res){res.data.errors&&reject(res.data),self.newcontact_data=res.data.contact,resolve()})})},self.deleteContactAddress=function(address_id,contact_id){return $q(function(resolve,reject){$http.delete("/contact/"+contact_id+"/address/"+address_id+"?updated_user_id="+user.user_data.admin_user_id).then(function(res){resolve()},function(err){reject(err.data)})})},self.deleteContactEmail=function(email_id,contact_id){return $q(function(resolve,reject){$http.delete("/contact/"+contact_id+"/email/"+email_id+"?updated_user_id="+user.user_data.admin_user_id).then(function(res){resolve()},function(err){reject(err.data)})})},self.deleteContactPhone=function(phone_id,contact_id){return $q(function(resolve,reject){$http.delete("/contact/"+contact_id+"/phone/"+phone_id+"?updated_user_id="+user.user_data.admin_user_id).then(function(res){resolve()},function(err){reject(err.data)})})},self.deleteContact=function(contact_id){return $q(function(resolve,reject){$http.delete("/contact/"+contact_id+"?updated_user_id="+user.user_data.admin_user_id).then(function(res){resolve()},function(err){reject(err.data)})})}}function eventService($http,$q,$filter,group,user){var self=this;self.eventContactAddress=[],self.forceRefresh=!1,self.initializeEvent=function(group_id,event_id){var existingGroupId=group.group_data.group_id;return $q(function(resolve,reject){if(self.forceRefresh||!self.event_data||self.event_data.event_id!=event_id||existingGroupId!=group_id){self.forceRefresh=!1;var getGroupData=function(callback){group.initializeGroup(group_id).then(function(){callback(null)},function(err){callback(err)})},getEventDetails=function(callback){self.getEventById(event_id).then(function(){callback(null)},function(err){callback(err)})},getEventContactAddresses=function(callback){self.getEventContactAddresses(self.event_data.event_contacts).then(function(){callback(null)},function(err){callback(err)})};async.waterfall([getGroupData,getEventDetails,getEventContactAddresses],function(err){err&&reject(err),resolve()})}else resolve()})},self.getEventContactAddresses=function(contacts){return self.eventContactAddress=[],$q(function(resolve,reject){if(contacts.length>0){var contact_ids="";angular.forEach(contacts,function(value){contact_ids=value.contact_id+","+contact_ids}),$http.get("/contact/"+contact_ids+"/addresses").then(function(res){self.eventContactAddress=res.data.addresses,resolve()},function(err){reject(err.data)})}else resolve()})},self.getEventById=function(event_id){return $q(function(resolve,reject){$http.get("/event/"+event_id).then(function(res){res.data.errors&&reject(res.data),self.event_data=res.data.event,resolve()})})},self.updateEventDetails=function(event){return event.planned_date&&(event.planned_date=$filter("date")(event.planned_date,"yyyy-MM-dd")),$q(function(resolve,reject){event.updated_user_id=user.user_data.admin_user_id,$http.put("/event/"+event.event_id,JSON.stringify(event)).then(function(res){void 0,res.data.errors&&reject(res.data),self.event_data=res.data.event,resolve()})})},self.associateContactWithEvent=function(event_ids,contact_ids){var address=null;return $q(function(resolve,reject){var associate=function(callback){var data={};data.contact_ids=contact_ids,data.event_ids=event_ids,data.created_user_id=user.user_data.admin_user_id,$http.post("/event/contact",data).then(function(res){res.data.errors&&callback(res.data.errors),callback(null)})},getAddresses=function(callback){var contacts="";angular.forEach(contact_ids,function(value){contacts=contacts+","+value}),$http.get("/contact/"+contacts+"/addresses").then(function(res){res.data.errors&&callback(res.data.errors),res.data.addresses?(address=res.data.addresses[0],void 0,callback(null)):callback(null)})},checkPlannedFrom=function(callback){address?async.each(event_ids,function(event_id,callback){self.checkPlannedAddressAutoFill(event_id,address).then(function(){callback(null)},function(err){callback(err)})},function(err){err?callback(err):callback()}):callback()};async.waterfall([associate,getAddresses,checkPlannedFrom],function(err){err?reject(err):resolve()})})},self.checkPlannedAddressAutoFill=function(event_id,address){return $q(function(resolve,reject){$http.get("/event/"+event_id).then(function(res){res.data.event.planned_address.street_address?resolve(null):self.setEventAddress(address.address_id,event_id).then(function(){resolve()},function(err){reject(err)})},function(err){reject(err.data)})})},self.createNewEvent=function(newEventData,contacts){return $q(function(resolve,reject){var newEvent=function(callback){self.createEvent(newEventData).then(function(){callback(null)},function(err){callback(err)})},EventContacts=function(callback){var contact_ids=[];angular.forEach(contacts,function(value){contact_ids.push(value.contact_id)}),contact_ids==[]&&reject("contact required"),self.associateContactWithEvent([self.newEvent_id],contact_ids).then(function(){callback(null)},function(err){callback(err)})},EventAddress=function(callback){newEventData.planned_address?self.setEventAddress(newEventData.planned_address.address_id,self.newEvent_id).then(function(){callback(null)},function(err){callback(err)}):callback(null)};async.waterfall([newEvent,EventContacts,EventAddress],function(err){err&&reject(err),resolve()})})},self.setEventAddress=function(address_id,newEvent_id){return $q(function(resolve,reject){$http.post("/event/"+newEvent_id+"/event_address/"+address_id,{created_user_id:user.user_data.admin_user_id}).then(function(res){resolve()},function(err){reject(err.data)})})},self.createEvent=function(newEvent){return $q(function(resolve,reject){newEvent.start_date||newEvent.end_date?(newEvent.start_date=$filter("date")(newEvent.start_date,"yyyy-MM-dd").toString(),newEvent.end_date=$filter("date")(newEvent.end_date,"yyyy-MM-dd").toString()):reject("need start and end date"),newEvent.planned_date&&(newEvent.planned_date=$filter("date")(new Date(newEvent.planned_date),"yyyy-MM-dd")),newEvent.group_id=group.group_data.group_id,newEvent.created_user_id=user.user_data.admin_user_id;var decision_criteria=[];newEvent.decision_criteria&&angular.forEach(newEvent.decision_criteria,function(value){decision_criteria.push(value.decision_type_id)}),newEvent.decision_criteria=decision_criteria,angular.forEach(newEvent.event_days,function(value){value.day_functions&&angular.forEach(value.day_functions,function(value2){var rooms="";value2.rooms&&angular.forEach(value2.rooms,function(value3){rooms=rooms+","+value3.room_id}),value2.rooms=rooms})}),$http.post("/event",newEvent).then(function(res){res.data.errors&&reject(res.data),self.newEvent_id=res.data.event.event_id,resolve()})})},self.updateEventDayFunction=function(event_day_id,day_function){var function_info=angular.copy(day_function),rooms="";return angular.forEach(function_info.rooms,function(value){rooms=rooms+","+value.room_id}),function_info.rooms=rooms,function_info.updated_user_id=user.user_data.admin_user_id,function_info.start_time&&(function_info.start_time=$filter("date")(function_info.start_time," yyyy-MM-dd HH:mm:ss").toString()),function_info.end_time&&(function_info.end_time=$filter("date")(function_info.end_time," yyyy-MM-dd HH:mm:ss").toString()),$q(function(resolve,reject){$http.put("/event/"+self.event_data.event_id+"/event_day/"+event_day_id+"/day_function/"+day_function.function_id,function_info).then(function(res){self.event_data=res.data.event,resolve()},function(err){reject(err.data)})})},self.createEventDayFunction=function(event_day_id,day_function){var function_info=angular.copy(day_function),rooms="";return angular.forEach(function_info.rooms,function(value){rooms=rooms+","+value.room_id}),function_info.rooms=rooms,function_info.updated_user_id=user.user_data.admin_user_id,function_info.start_time&&function_info.end_time&&(function_info.start_time=$filter("date")(function_info.start_time," yyyy-MM-dd HH:mm:ss").toString(),function_info.end_time=$filter("date")(function_info.end_time," yyyy-MM-dd HH:mm:ss").toString()),$q(function(resolve,reject){$http.post("/event/"+self.event_data.event_id+"/event_day/"+event_day_id+"/day_function/",function_info).then(function(res){self.event_data=res.data.event,resolve()},function(err){reject(err.data)})})},self.createEventDay=function(NewEventDay){var data={};return data.event_day_date=NewEventDay,data.created_user_id=user.user_data.admin_user_id,$q(function(resolve,reject){$http.post("/event/"+self.event_data.event_id+"/event_day",data).then(function(res){self.event_data=res.data.event,resolve()},function(err){reject(err.data)})})},self.changeGroup=function(event_id,group_id){var data={};return data.updated_user_id=user.user_data.admin_user_id,$q(function(resolve,reject){$http.put("/event/"+event_id+"/group/"+group_id,data).then(function(res){self.event_data=res.data.event,resolve()},function(err){reject(err.data)})})}}function groupService($http,$q,user,$stateParams,$filter){var self=this;self.group_data={},self.getGroupById=function(group_id){return $q(function(resolve,reject){$http.get("/group/"+group_id).then(function(res){self.group_data=res.data.group,resolve()},function(err){reject(err.data)})})},self.getGroupAddresses=function(group_id){return $q(function(resolve,reject){$http.get("/group/"+group_id+"/addresses").then(function(res){self.group_data.addresses=res.data.addresses,resolve()},function(err){reject(err.data)})})},self.getGroupHqAddress=function(){var hq={};return angular.forEach(self.group_data.addresses,function(value,key){!0===value.is_hq&&(hq=value)}),hq},self.getGroupPhones=function(group_id){return $q(function(resolve,reject){$http.get("/group/"+group_id+"/phones").then(function(res){self.group_data.phones=res.data.phones,resolve()},function(err){reject(err.data)})})},self.getGroupContacts=function(group_id){return $q(function(resolve,reject){$http.get("/group/"+group_id+"/contacts").then(function(res){res.data.errors&&reject(res.data),self.contactTotalPages=res.data.total_pages,self.contactCurrentPage=res.data.current_page,self.contacts=res.data.contacts,resolve()})})},self.getGroupEventContacts=function(group_id){return $q(function(resolve,reject){$http.get("/group/"+group_id+"/events/contacts").then(function(res){self.event_contacts=res.data.contacts,resolve()},function(err){reject(err.data)})})},self.getFilteredContacts=function(group_id,searchParams,page,sort){return $q(function(resolve,reject){$http.get("/group/"+group_id+"/contacts?"+(searchParams.job_title?"job_title="+searchParams.job_title:"")+(searchParams.name?"&contact_name="+searchParams.name:"")+(searchParams.phone_num?"&phone_num="+searchParams.phone_num:"")+(searchParams.email_address?"&email_address="+searchParams.email_address:"")+"&page_number="+page+"&sort_by="+sort).then(function(res){self.contactTotalPages=res.data.total_pages,self.contactCurrentPage=res.data.current_page,self.contacts=res.data.contacts,resolve()},function(err){reject(err.data)})})},self.getGroupEventList=function(group_id){return $q(function(resolve,reject){$http.get("/group/"+group_id+"/events").then(function(res){self.events=res.data.events,self.eventTotalPages=res.data.total_pages,self.eventCurrentPage=res.data.current_page,resolve()},function(err){reject(err.data)})})},self.getFilteredEvents=function(group_id,searchParams,page,sort){(searchParams.start_date||searchParams.end_date)&&(searchParams.start_date=$filter("date")(new Date(searchParams.start_date),"yyyy-MM-dd"),searchParams.end_date=$filter("date")(new Date(searchParams.end_date),"yyyy-MM-dd"));var contacts="";return angular.forEach(searchParams.contacts,function(value,key){contacts=contacts+value.contact_id+","}),$q(function(resolve,reject){$http.get("/group/"+group_id+"/events?"+(searchParams.hotel?"hotel_name="+searchParams.hotel:"")+(searchParams.event_keyword?"&event_name="+searchParams.event_keyword:"")+(searchParams.start_date?"&start_date="+searchParams.start_date:"")+(searchParams.end_date?"&end_date="+searchParams.end_date:"")+(contacts?"&event_contacts="+contacts:"")+"&page_number="+page+"&sort_by="+sort).then(function(res){self.events=res.data.events,self.eventTotalPages=res.data.total_pages,self.eventCurrentPage=res.data.current_page,resolve()},function(err){reject(err.data)})})},self.postGroupAddress=function(group_id,newAddress){return $q(function(resolve,reject){newAddress.created_user_id=user.user_data.admin_user_id,$http.post("/group/"+group_id+"/address",JSON.stringify(newAddress)).then(function(res){self.group_data.addresses=res.data.group.addresses,resolve()},function(err){reject(err.data)})})},self.postGroupPhone=function(newphone){return $q(function(resolve,reject){newphone.created_user_id=user.user_data.admin_user_id,$http.post("/group/"+$stateParams.group_id+"/phone",JSON.stringify(newphone)).then(function(res){self.group_data.phones=res.data.group.phones,resolve()},function(err){reject(err.data)})})},self.updateGroupDetails=function(groupData){return $q(function(resolve,reject){groupData.updated_user_id=user.user_data.admin_user_id,void 0,$http.put("/group/"+groupData.group_id,JSON.stringify(groupData)).then(function(res){self.group_data=res.data.group,resolve()},function(err){reject(err.data)})})},self.updateGroupAddress=function(address){return $q(function(resolve,reject){address.updated_user_id=user.user_data.admin_user_id,$http.put("/group/"+$stateParams.group_id+"/address/"+address.address_id,JSON.stringify(address)).then(function(res){self.group_data.addresses=res.data.group.addresses,resolve()},function(err){reject(err.data)})})},self.updateGroupPhone=function(phone){return $q(function(resolve,reject){phone.updated_user_id=user.user_data.admin_user_id,$http.put("/group/"+$stateParams.group_id+"/phone/"+phone.phone_id,JSON.stringify(phone)).then(function(res){self.group_data.phones=res.data.group.phones,resolve()},function(err){reject(err.data)})})},self.deleteGroupAddress=function(address_id){return $q(function(resolve,reject){$http.delete("/group/"+$stateParams.group_id+"/address/"+address_id+"?updated_user_id="+user.user_data.admin_user_id).then(function(res){resolve()},function(err){reject(err.data)})})},self.deleteGroupPhone=function(id){return $q(function(resolve,reject){$http.delete("/group/"+$stateParams.group_id+"/phone/"+id+"?updated_user_id="+user.user_data.admin_user_id).then(function(res){resolve()},function(err){reject(err.data)})})},self.initializeGroup=function(group_id){return $q(function(resolve,reject){if(self.group_data.group_id!=group_id){var GroupById=function(callback){self.getGroupById(group_id).then(function(){callback(null)},function(err){callback(err)})},GroupEventList=function(callback){self.getGroupEventList(group_id).then(function(){callback(null)},function(err){callback(err)})},GroupContacts=function(callback){self.getGroupContacts(group_id).then(function(){callback(null)},function(err){callback(err)})},GroupEventContacts=function(callback){self.getGroupEventContacts(group_id).then(function(){callback(null)},function(err){callback(err)})},GroupAddresses=function(callback){self.getGroupAddresses(group_id).then(function(){callback(null)},function(err){callback(err)})};async.waterfall([GroupById,GroupEventList,GroupContacts,GroupEventContacts,GroupAddresses],function(err){err&&reject(err),resolve()})}else resolve()})},self.getTempContacts=function(group_id){return $q(function(resolve,reject){$http.get("/group/"+group_id+"/contacts").then(function(res){self.tempContacts=res.data.contacts,resolve()},function(err){reject(err.data)})})},self.getTempFilterContacts=function(group_id,searchParams){return $q(function(resolve,reject){$http.get("/group/"+group_id+"/contacts?"+(searchParams.job_title?"job_title="+searchParams.job_title:"")+(searchParams.name?"&contact_name="+searchParams.name:"")+(searchParams.phone_num?"&phone_num="+searchParams.phone_num:"")+(searchParams.email_address?"&email_address="+searchParams.email_address:"")).then(function(res){self.tempContacts=res.data.contacts,resolve()},function(err){reject(err.data)})})},self.getGroupList=function(groupName,page,sort){if(groupName)return $q(function(resolve,reject){$http.get("/group/search?group_name="+groupName+(page?"&page_number="+page:"")+(sort?"&sort_by="+sort:"")).then(function(res){self.groupList=res.data.groups,self.currentPage=res.data.current_page,self.totalPages=res.data.total_pages,resolve()},function(err){reject(err.data)})})},self.checkAddress=function(address){return $q(function(resolve,reject){$http.post("/group/checkAddress",address).then(function(res){self.Addresscheck=res.data.Check,resolve()},function(err){reject(err.data)})})},self.checkForGroup=function(data){return $q(function(resolve,reject){$http.post("group/check",data).then(function(res){self.check=res.data.Check,resolve()},function(err){reject(err.data)})})},self.postNewGroup=function(data,address){return data.created_user_id=user.user_data.admin_user_id,$q(function(resolve,reject){$http.post("group",data).then(function(res){self.new_group_data=res.data.group,address.street_address=address.street,address.is_hq=!0,address.address_type_id=1,self.postGroupAddress(self.new_group_data.group_id,address).then(function(){resolve()},function(err){reject(err)})},function(err){reject(err.data)})})}}function hotelService($http,$q,$filter){var self=this;self.theHotel={},self.getHotelList=function(name){return $q(function(resolve,reject){$http.get("/master_account/hotel/read_hotels?hotel_name="+name).then(function(res){self.hotels=res.data.hotels,resolve()},function(err){reject(err.data)})})},self.getHotelDetails=function(hotel_id){return $q(function(resolve,reject){$http.get("/master_account/hotel/"+hotel_id).then(function(res){self.theHotel=res.data.hotel,res.data.hotel.rooms&&(self.rooms=res.data.hotel.rooms),resolve(res.data)},function(err){reject(err.data)})})},self.searchAllHotels=function(data,page,sort){return $q(function(resolve,reject){var query=data,searchQuery=[],builder=[];query.Markets&&query.Markets.length>0&&(builder=[],query.Markets.forEach(function(item){void 0,builder.push(item.market_id)}),searchQuery.push("(market_id:"+builder.join(" OR market_id:")+")"));var stateTemp=new Set,countryTemp=new Set;query.States&&angular.forEach(query.States,function(value){null==value.state_id?countryTemp.add(value.country):(stateTemp.add(value.state),countryTemp.add(value.country))}),stateTemp.size>0&&(builder=[],stateTemp.forEach(function(item){try{builder.push(item)}catch(err){void 0}}),searchQuery.push("(state:"+builder.join(" OR state:")+")")),countryTemp.size>0&&(builder=[],countryTemp.forEach(function(item){builder.push(item)}),searchQuery.push("(country:"+builder.join(" OR country:")+")")),query.brands.length>0&&(builder=[],query.brands.forEach(function(item){builder.push(item.brand)}),searchQuery.push("(brand:"+builder.join(" OR brand:")+")")),query.hotel_name&&(builder=[],builder.push(query.hotel_name),searchQuery.push("(hotel_name:"+builder.join(" OR hotel_name:")+")")),query.city&&(builder=[],builder.push(query.city),searchQuery.push("(city:"+builder.join(" OR city:")+")")),searchQuery.push("(hotel_id:[1 TO 1000000])"),void 0;var body={q:searchQuery.join(" AND "),page:page,sort_by:sort};$http.post("/master_account/hotel_search",body).then(function(res){self.totalPages=res.data.total_pages,self.currentPage=res.data.current_page,self.hotels=res.data.hotels,resolve()},function(err){reject(err.data)})})},self.getHotelImagesByDate=function(hotel_id,read_date){var simplifiedDate=$filter("date")(read_date,"yyyy-MM-dd");return $q(function(resolve,reject){$http.get("/master_account/hotel/"+hotel_id+"/raw_images/?read_date="+simplifiedDate).then(function(res){resolve(res.data)},function(err){reject(err.data)})})},self.getHotelImagesByResearcher=function(hotel_id,researcher_id){return $q(function(resolve,reject){$http.get("/master_account/hotel/"+hotel_id+"/raw_images/"+researcher_id).then(function(res){
    resolve(res.data)},function(err){reject(err.data)})})}}function httpInterceptor($localstorage){return{request:function(config){var token=$localstorage.get("token");$localstorage.get("api_token");return token&&(config.headers["x-access-token"]=token),config}}}function localStorageService($window){return{set:function(key,value){$window.localStorage[key]=value},get:function(key,defaultValue){return $window.localStorage[key]||defaultValue},setObject:function(key,value){$window.localStorage[key]=JSON.stringify(value)},getObject:function(key){return JSON.parse($window.localStorage[key]||"{}")}}}function partialsService($uibModal){var self=this;self.is_loading=!1,self.animationsEnabled=!0,self.previewObj={helloWorld:"hello world",imageSrc:"",imageAlt:"",images:[]},self.showImagePreview=function(previewObj){$uibModal.open({appendTo:angular.element(document.querySelector("#modalWindow")),animation:self.animationsEnabled,component:"imagePreview",backdropClass:"globalWarning-bg",resolve:{previewObj:function(){return previewObj}}})}}function referenceService($http,$q,$localstorage){var self=this;self.address_types=[],self.countries=[],self.states=[],self.phone_types=[],self.email_types=[],self.salutations=[],self.job_titles=[],self.dnc_reasons=[],self.industry_segs=[],self.industry_sub_segs=[],self.hotel_states=[],self.ma_users=[],self.initializeReferences=function(){return $q(function(resolve,reject){if(angular.isUndefined($localstorage.getObject("all_references"))||"true"==$localstorage.get("first_login"))$http.get("ref/all_references").then(function(res){$localstorage.set("first_login",!1),$localstorage.setObject("all_references",res.data.references),self.address_types=res.data.references.address_types,self.countries=res.data.references.countries,self.states=res.data.references.states,self.phone_types=res.data.references.phone_types,self.email_types=res.data.references.email_types,self.salutations=res.data.references.salutations,self.job_titles=res.data.references.job_titles,self.dnc_reasons=res.data.references.dnc_reasons,self.industry_segs=res.data.references.industry_segs,self.industry_sub_segs=res.data.references.industry_sub_segs,self.verification_statuses=res.data.references.verification_statuses,self.hotel_markets=res.data.references.hotel_markets,self.brands=res.data.references.brands,self.decision_types=res.data.references.decision_types,self.channel_types=res.data.references.channel_types,self.RFP_sources=res.data.references.RPF_sources,self.chain_scales=res.data.references.chain_scales,self.market_tiers=res.data.references.market_tiers,self.data_core_users=res.data.references.data_core_users,self.currency_codes=res.data.references.currency_codes,self.sales_account_types=res.data.references.sales_account_types,self.billing_preferences=res.data.references.billing_preferences,self.ma_users=res.data.references.ma_users,self.mgmt_cos=res.data.references.management_companies,self.hotel_class=res.data.references.classes,self.tract_code=res.data.references.tract_code,self.kg_products=res.data.references.kg_products,self.location=res.data.references.location,self.global_region=res.data.references.global_region,self.market_code=res.data.references.market_code,self.all_markets=res.data.references.all_markets,self.bindMultiSelects(self.industry_segs,self.industry_sub_segs,self.verification_statuses,self.hotel_markets,self.data_core_users,self.brands),resolve()},function(err){reject(err.data.references)});else{var refs=$localstorage.getObject("all_references");self.address_types=refs.address_types,self.countries=refs.countries,self.states=refs.states,self.phone_types=refs.phone_types,self.email_types=refs.email_types,self.salutations=refs.salutations,self.job_titles=refs.job_titles,self.dnc_reasons=refs.dnc_reasons,self.industry_segs=refs.industry_segs,self.industry_sub_segs=refs.industry_sub_segs,self.verification_statuses=refs.verification_statuses,self.hotel_markets=refs.hotel_markets,self.brands=refs.brands,self.decision_types=refs.decision_types,self.channel_types=refs.channel_types,self.RFP_sources=refs.RPF_sources,self.chain_scales=refs.chain_scales,self.market_tiers=refs.market_tiers,self.data_core_users=refs.data_core_users,self.currency_codes=refs.currency_codes,self.sales_account_types=refs.sales_account_types,self.billing_preferences=refs.billing_preferences,self.ma_users=refs.ma_users,self.mgmt_cos=refs.management_companies,self.hotel_class=refs.classes,self.tract_code=refs.tract_code,self.kg_products=refs.kg_products,self.location=refs.location,self.global_region=refs.global_region,self.market_code=refs.market_code,self.all_markets=refs.all_markets,self.bindMultiSelects(self.industry_segs,self.industry_sub_segs,self.verification_statuses,self.all_markets,self.data_core_users,self.brands),resolve()}})},self.bindMultiSelects=function(ind_segs,ind_sub_segs,verifications_stats,markets,users,brands){self.dropDownInds=[],self.dropDownVerifications=[],self.dropDownMarkets=[],self.dropDownUsers=[],self.dropDownBrands=[],angular.forEach(brands,function(value){var x={brand_id:value.brand_id,brand:value.brand,ticked:!1};self.dropDownBrands.push(x)}),angular.forEach(ind_segs,function(value){self.dropDownInds.push({name:value.industry_seg,msGroup:!0}),angular.forEach(ind_sub_segs,function(value2){if(value2.industry_seg===value.industry_seg){var x={name:value2.industry_sub_seg,id:value2.industry_sub_seg_id,ticked:!1};self.dropDownInds.push(x)}}),self.dropDownInds.push({msGroup:!1})}),angular.forEach(verifications_stats,function(value){var x={name:value.verification_status,id:value.verification_status_id,ticked:!1};self.dropDownVerifications.push(x)}),angular.forEach(markets,function(value){var x={name:value.hotel_market,market_id:value.hotel_market_id,ticked:!1};self.dropDownMarkets.push(x)}),angular.forEach(users,function(value){var x={name:value.user_name,id:value.user_id,ticked:!1};self.dropDownUsers.push(x)})},self.hotelStatesBindToDropDrown=function(){if(!self.Hotel_State_DropDown){var stateDropDown=[],data=self.hotel_states,currentCountry=data[0].country_id;stateDropDown.push({name:data[0].country,msGroup:!0}),stateDropDown.push({name:data[0].state_name,country:data[0].country,country_id:data[0].country_id,state_id:data[0].state_id,state:data[0].state,ticked:!1}),angular.forEach(data,function(value){value.country_id==currentCountry?stateDropDown.push({name:value.state_name,country:value.country,country_id:value.country_id,state_id:value.state_id,state:value.state,ticked:!1}):(stateDropDown.push({msGroup:!1}),currentCountry=value.country_id,stateDropDown.push({name:value.country,msGroup:!0}),stateDropDown.push({name:value.state_name,country:data[0].country,country_id:value.country_id,state_id:value.state_id,ticked:!1}))}),stateDropDown.push({msGroup:!1}),self.Hotel_State_DropDown=stateDropDown}},self.getHotelState=function(){return $q(function(resolve,reject){$http.get("ref/hotel/states?kg_only=true").then(function(res){self.hotel_states=res.data.hotel_states,self.hotelStatesBindToDropDrown(),resolve()},function(res){reject(res.data)})})},self.getHotelMarkets=function(){return $q(function(resolve,reject){angular.isUndefined($localstorage.getObject("all_references").hotel_markets)?$http.get("/ref/hotel_markets").then(function(res){self.hotel_markets=res.data.hotel_markets,self.hotelStatesBindToDropDrown(),resolve()},function(res){reject(res.data)}):(self.hotel_markets=$localstorage.getObject("all_references").hotel_markets,resolve())})},self.getCountries=function(){return $q(function(resolve,reject){angular.isUndefined($localstorage.getObject("all_references").countries)?$http.get("/ref/countries").then(function(res){self.countries=res.data.countries,resolve()},function(res){reject(res.data)}):(self.countries=$localstorage.getObject("all_references").countries,resolve())})},self.getStates=function(){return $q(function(resolve,reject){angular.isUndefined($localstorage.getObject("all_references").states)?$http.get("/ref/states").then(function(res){self.states=res.data.states,resolve()},function(res){reject(res.data)}):(self.states=$localstorage.getObject("all_references").states,resolve())})},self.getSalutations=function(){return $q(function(resolve,reject){angular.isUndefined($localstorage.getObject("all_references").salutations)?$http.get("/ref/salutations").then(function(res){self.salutations=res.data.salutations,resolve()},function(res){reject(res.data)}):(self.salutations=$localstorage.getObject("all_references").salutations,resolve())})},self.getStatesByCountry=function(country){return $q(function(resolve,reject){$http.get("/ref/country/states?country="+country).then(function(res){self.states=res.data.states,resolve()},function(res){reject(res.data)})})},self.getCurrencyCodes=function(){return $q(function(resolve,reject){angular.isUndefined($localstorage.getObject("all_references").currency_codes)?$http.get("/ref/salutations").then(function(res){self.currency_codes=res.data.currency_codes,resolve()},function(res){reject(res.data)}):(self.currency_codes=$localstorage.getObject("all_references").currency_codes,resolve())})},self.getCurrencySymbols=function(){return $q(function(resolve,reject){$http.get("/ref/currency_symbol").then(function(res){self.currency_symbols=res.data.currency_symbols,resolve()},function(res){reject(res.data)})})},self.getSalesBrands=function(){return $q(function(resolve,reject){self.sales_brands?resolve():$http.get("/ref/reports/brands").then(function(res){self.sales_brands=res.data,resolve()},function(res){reject(res.data)})})},self.getMgmtCos=function(){return $q(function(resolve,reject){self.mgmt_cos?resolve():$http.get("/ref/reports/mgmtcos").then(function(res){self.mgmt_cos=res.data,resolve()},function(res){reject(res.data)})})},self.getReportClients=function(){return $q(function(resolve,reject){self.report_clients?resolve():$http.get("/ref/reports/clients").then(function(res){self.report_clients=res.data,resolve()},function(res){reject(res.data)})})},self.getUserByPermissionId=function(id){return $q(function(resolve,reject){$http.get("/user/permission/"+id).then(function(res){res.data.errors?reject(res.data):(9===id&&(self.fr_admins=res.data.users),4===id&&(self.account_mangers=res.data.users),8===id&&(self.sales_people=res.data.users),self.users=res.data.users,resolve())})})},self.getTractByMarketId=function(market_id){return $q(function(resolve,reject){$http.get("/ref/tract/market/"+market_id).then(function(res){self.tracts=res.data.tracts,resolve()},function(res){reject(res.data)})})},self.getSalesPeople=function(){return $q(function(resolve,reject){self.sales_people?resolve():$http.get("/ref/reports/salespeople").then(function(res){self.sales_people=res.data,resolve()},function(res){reject(res.data)})})},self.getHotelBrands=function(){return $q(function(resolve,reject){angular.isUndefined($localstorage.getObject("all_references").brands)?$http.get("/ref/hotel_brands").then(function(res){self.brands=res.data.brands,resolve()},function(res){reject(res.data)}):(self.brands=$localstorage.getObject("all_references").brands,resolve())})},self.getSalesAccountTypes=function(){return $q(function(resolve,reject){angular.isUndefined($localstorage.getObject("all_references").sales_account_types)?$http.get("/ref/sales_accounts").then(function(res){self.sales_account_types=res.data.sales_account_types,resolve()},function(res){reject(res.data)}):(self.sales_account_types=$localstorage.getObject("all_references").sales_account_types,resolve())})},self.getBillingPreferences=function(){return $q(function(resolve,reject){angular.isUndefined($localstorage.getObject("all_references").billing_preferences)?$http.get("/ref/billing_preferences").then(function(res){self.billing_preferences=res.data.billing_preferences,resolve()},function(res){reject(res.data)}):(self.billing_preferences=$localstorage.getObject("all_references").billing_preferences,resolve())})},self.getMAUsers=function(){return $q(function(resolve,reject){angular.isUndefined($localstorage.getObject("all_references").ma_users)?$http.get("/ref/ma_users").then(function(res){self.ma_users=res.data.ma_users,resolve()},function(res){reject(res.data)}):(self.ma_users=$localstorage.getObject("all_references").ma_users,resolve())})},self.getMAClients=function(){return $q(function(resolve,reject){$http.get("/ref/ma_clients").then(function(res){self.ma_clients=res.data.ma_clients,resolve()},function(res){reject(res.data)})})},self.getHotelManagementCompanies=function(){return $q(function(resolve,reject){$http.get("/ref/hotel_mgmt_co").then(function(res){self.management_companies=res.data.management_companies,resolve()},function(res){reject(res.data)})})},self.getPermissionGroupsInternal=function(){return $q(function(resolve,reject){$http.get("/ref/permission_groups").then(function(res){self.permission_groups=res.data.permission_groups,resolve()},function(res){reject(res.data)})})}}function researcherService($http,$q){var self=this;self.getResearcherContract=function(){return $q(function(resolve,reject){$http.get("/researcher/contract").then(function(res){resolve(res.data)},function(err){reject(err.data)})})},self.getResearcherContractById=function(researcher_id,contract_id){return $q(function(resolve,reject){$http.get("/researcher/"+researcher_id+"/contract/"+contract_id).then(function(res){resolve(res.data)},function(err){reject(err.data)})})},self.getResearcherContracts=function(researcher_id){return $q(function(resolve,reject){$http.get("/researcher/"+researcher_id+"/contracts").then(function(res){resolve(res.data)},function(err){reject(err.data)})})},self.getResearcherActiveContract=function(researcher_id){return $q(function(resolve,reject){$http.get("/researcher/"+researcher_id+"/active_contract/").then(function(res){resolve(res.data)},function(err){reject(err.data)})})},self.acceptContract=function(contract_id,user_id){return $q(function(resolve,reject){$http.post("/researcher/"+user_id+"/accept/"+contract_id).then(function(res){resolve()},function(err){reject(err.data)})})},self.getResearcherByUserId=function(fr_id){return $q(function(resolve,reject){$http.get("route/researcher/"+fr_id).then(function(res){resolve(res.data)},function(err){reject(err.data)})})},self.getResearcherBankStatement=function(fr_id,date){return $q(function(resolve,reject){$http.get("route/researcher/"+fr_id+"/bank?period_end_date="+date).then(function(res){resolve(res.data)},function(err){reject(err.data)})})}}function tabsService(){var self=this;self.contact_event=!1,self.groupTabs={phone:!1,address:!0},self.contactTabs={phone:!1,address:!0,email:!1}}function userService($http,$localstorage,$q){function saveUser(token,user,api_token){$localstorage.set("token",token),$localstorage.setObject("user",user),$localstorage.set("first_login",!0),$localstorage.set("api_token",api_token),self.user_data=user,self.token=token,self.api_token=api_token,self.is_loggedin=!0}var self=this;self.user_data=$localstorage.getObject("user",null),self.token=$localstorage.get("token",""),self.api_token=$localstorage.get("api_token",""),self.env=$localstorage.get("env",""),self.is_loggedin=!1,self.contactFilter={},self.eventFilter={},self.verificationFilter={},self.associateFlag=!1,self.verificaitonsFlag=!1,self.eventContactCreation=!1,self.getEnv=function(){$q(function(resolve,reject){$http.get("/env").then(function(res){$localstorage.set("env",res.data),self.env=res.data,resolve()},function(res){res.data&&reject(res.data.error)})})},self.login=function(email,password){return $q(function(resolve,reject){$http.post("/login",{email:email,password:password}).then(function(res){saveUser(res.data.token,res.data.user,res.data.api_token),resolve()},function(res){res.data&&reject(res.data.error)})})},self.checkToken=function(){return $q(function(resolve,reject){$http.get("/verify_auth").then(function(){self.is_loggedin=!0,resolve()},function(){self.is_loggedin=!1,reject()})})},self.logout=function(){return $q(function(resolve,reject){$localstorage.set("token",""),$localstorage.setObject("user",{}),$localstorage.set("api_token",""),$localstorage.set("env",""),self.is_loggedin=!1,self.user_data={},self.token="",self.api_token="",self.env="",resolve()})},self.requestReset=function(email){return $q(function(resolve,reject){$http.post("/login/request_reset",{email:email}).then(function(res){void 0,void 0,res.data.errors&&reject(res.data),resolve(res.data)},function(res){void 0,res.data&&reject(res.data.error)})})},self.checkResetToken=function(reset_id){return $q(function(resolve,reject){$http.get("/login/validate_reset_request/"+reset_id).then(function(res){resolve(res.data.success?!0:!1)},function(res){reject(res.data.error)})})},self.resetPassword=function(reset_id,password){return $q(function(resolve,reject){$http.post("/login/reset_password",{reset_id:reset_id,password:password}).then(function(res){void 0,void 0,res.data.errors&&reject(res.data),resolve(res.data)},function(res){void 0,res.data&&reject(res.data.error)})})},self.getInternalUsers=function(){return $q(function(resolve,reject){$http.get("/user/dc_user_details").then(function(res){self.internalUsers=res.data.users,resolve()},function(err){reject(err.data)})})},self.createUser=function(user){return user.created_user_id=self.user_data.admin_user_id,$q(function(resolve,reject){$http.post("/user/data_core",user).then(function(res){self.internalUsers=res.data.users,resolve()},function(err){reject(err.data)})})},self.updateUser=function(user){return user.updated_user_id=self.user_data.admin_user_id,$q(function(resolve,reject){$http.put("/user/data_core",user).then(function(res){self.internalUsers=res.data.users,resolve()},function(err){reject(err.data)})})}}function verificationWorkFlowService($http,$q,user,$localstorage){function fixDate(date){var temp_date=new Date(date);return temp_date=temp_date.getTime()+6e4*temp_date.getTimezoneOffset()}var self=this;self.group={},self.event={},self.contact={},self.verifications=[],self.verification={},self.updateStatus=function(status_id,verification_ids,note){var data={};return data.updated_user_id=user.user_data.admin_user_id,data.status_id=status_id,data.verification_ids=verification_ids,note&&(data.note=note),$q(function(resolve,reject){$http.put("/verification/status",data).then(function(res){self.verifications=res.data.verifications,self.verifications&&self.verifications.length>0&&(self.verification=self.verifications[0]),resolve()},function(err){reject(err.data)})})},self.createNewVerificationNote=function(verification_id,note,attempt){var data={};return data.note=note,data.created_user_id=user.user_data.admin_user_id,data.log_attempt=!!attempt,$q(function(resolve,reject){$http.post("/verification/"+verification_id+"/note",data).then(function(res){res.data.errors&&reject(res.data),self.contact_attempts=res.data.Notes[0].contact_attempts,self.event_attempts=res.data.Notes[0].event_attempts,resolve()},function(err){reject(err.data)})})},self.getVerificationNotes=function(id){return $q(function(resolve,reject){$http.get("/verification/"+id+"/notes").then(function(res){self.notes=res.data.Notes,resolve()},function(err){reject(err.data)})})},self.updateAssignee=function(user_id,verification_ids){var data={};return data.updated_user_id=user.user_data.admin_user_id,data.assigned_user_id=user_id,data.verification_ids=verification_ids,$q(function(resolve,reject){$http.put("/verification/assignment",data).then(function(res){self.verifications=res.data.verifications,self.verifications&&self.verifications.length>0&&(self.verification=self.verifications[0]),self.saveToLocalStorage(),resolve()},function(err){reject(err.data)})})},self.saveToLocalStorage=function(){$localstorage.setObject("Verification",self.verification)},self.getFromLocalStorage=function(){return $localstorage.getObject("Verification",null)},self.getFollowUps=function(){return $q(function(resolve,reject){$http.get("/verification/followUps/"+user.user_data.admin_user_id).then(function(res){self.followUps=res.data.follow_ups,angular.forEach(self.followUps.pending,function(follow_up){follow_up.follow_up_date=fixDate(follow_up.follow_up_date)}),angular.forEach(self.followUps.future,function(follow_up){follow_up.follow_up_date=fixDate(follow_up.follow_up_date)}),resolve()},function(err){reject(err.data)})})},self.deleteFollowUp=function(follow_id){return $q(function(resolve,reject){$http.delete("/verification/followUp/"+follow_id+"/user/"+user.user_data.admin_user_id).then(function(res){self.followUps=res.data.follow_ups,resolve()},function(err){reject(err.data)})})},self.createNewFollowUp=function(verification_id,data){return data.created_user_id=user.user_data.admin_user_id,$q(function(resolve,reject){$http.post("/verification/"+verification_id+"/followUp",data).then(function(res){self.followUps=res.data.follow_ups,resolve()},function(err){void 0,reject(err.data)})})},self.updateFollowUp=function(verification_id,data){return data.updated_user_id=user.user_data.admin_user_id,$q(function(resolve,reject){$http.put("/verification/"+verification_id+"/followUp",data).then(function(res){self.followUps=res.data.follow_ups,resolve()},function(err){void 0,reject(err.data)})})},self.getVerificationById=function(id){return $q(function(resolve,reject){$http.get("/verification/"+id).then(function(res){self.verification=res.data.verification,self.verification.follow_up_id&&(self.verification.follow_up_date=fixDate(self.verification.follow_up_date)),resolve()},function(err){reject(err.data)})})}}localStorageService.$inject=["$window"],httpInterceptor.$inject=["$localstorage"],userService.$inject=["$http","$localstorage","$q"],referenceService.$inject=["$http","$q","$localstorage"],groupService.$inject=["$http","$q","user","$stateParams","$filter"],contactService.$inject=["$http","$q","group","user","$stateParams","event"],researcherService.$inject=["$http","$q"],eventService.$inject=["$http","$q","$filter","group","user"],hotelService.$inject=["$http","$q","$filter"],partialsService.$inject=["$uibModal"],loadingBoxDirective.$inject=["$rootScope","partials"],imagePreviewDirective.$inject=["$rootScope"],fileUploadDirective.$inject=["$filter","Upload","user","$timeout"],kgDatePickerDirective.$inject=["$filter"],navBarDirective.$inject=["$rootScope","user","$uibModal","$state"],angular.module("data-core-app",["ui.router","ct.ui.router.extras","ngMessages","ngAnimate","xeditable","checklist-model","angularMoment","isteven-multi-select","ui.bootstrap","ngFileUpload"]).factory("$localstorage",localStorageService).factory("httpInterceptor",httpInterceptor).service("user",userService).service("reference",referenceService).service("group",groupService).service("contact",contactService).service("researcher",researcherService).service("event",eventService).service("hotel",hotelService).service("partials",partialsService).directive("loadingBox",loadingBoxDirective).directive("imagePreview",imagePreviewDirective).directive("fileUpload",fileUploadDirective).directive("kgDatePicker",kgDatePickerDirective).directive("navBar",navBarDirective).directive("paginationDirective",paginationDirective),angular.module("data-core-app").config(["$stateProvider","$urlRouterProvider","$httpProvider","$compileProvider",function($stateProvider,$urlRouterProvider,$httpProvider,$compileProvider){$stateProvider.state("login-module",{url:"/login",public:!0,external:!0}).state("verifications-module",{url:"/verifications",module:"Verifications",external:!0}).state("administration-module",{url:"/administration",module:"Administration",external:!0}).state("field-research-module",{url:"/field-research",module:"Field Research",external:!0}).state("reports-module",{url:"/reports",module:"Reports",external:!0}).state("fr_admin-module",{url:"/field-research-admin",module:"Field Research Admin",external:!0}).state("master-accounts-module",{url:"/master-accounts",module:"Master Accounts",external:!0}).state("group-events-module",{url:"/group-events",module:"Group Events",external:!0}).state("account-sets-module",{url:"/account-sets",module:"Account Sets",external:!0}),$httpProvider.interceptors.push("httpInterceptor"),$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/)}]).run(["$rootScope","$state","$location","$window","user","editableOptions","editableThemes",function($rootScope,$state,$location,$window,user,editableOptions,editableThemes){user.getEnv(),editableOptions.theme="default",editableThemes.default.formTpl='<form class="form-inline editable-wrap width100 notEditField" role="form"></form>',editableThemes.default.noformTpl='<span class="editable-wrap notEditField"></span>',editableThemes.default.controlsTpl='<div class="editable-controls form-group width100 relative" ng-class="{\'has-error\': $error}"></div>',editableThemes.default.errorTpl='<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',editableThemes.default.buttonsTpl='<div class="btn-group btn-group-sm xbutton" role="group"></div>',editableThemes.default.submitTpl='<button type="submit" class="btn btn-default btn-edit" title="save"><i class="fa fa-check"></i></button>',editableThemes.default.cancelTpl='<button type="button" class="btn btn-default"  ng-click="$form.$cancel()" title="cancel"><i class="fa fa-close"></i></button>',editableOptions.activationEvent="dblclick",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){toState.public||user.checkToken().then(function(){-1==user.user_data.modules.indexOf(toState.module)&&(event.preventDefault(),fromState.external?$window.open(fromState.url,"_self"):$state.go(fromState,fromParams))},function(){event.preventDefault(),$window.open("/login","_self")}),toState.external&&$window.open(toState.url,"_self")})}]);