function verificationDetailController(e,t,n,a,i,o,r,c){e.canEdit=a.user_data.Access.Verifications.edit_access,e.updateView=function(){n.newcontact_data.contact_id||(e.contact=n.contact_data),e.group=o.group_data,e.event=i.event_data,e.events=o.events,e.contacts=o.contacts,n.newcontact_data={}},e.updateHeader=function(){r.group.group_id||(r.group=o.group_data),r.getVerificationById(r.verification.verification_id).then(function(){e.verificationWorkFlow={users:t.data_core_users,verification:r.verification,event:r.event,contact:r.contact,group:r.group}},function(e){$rootScope.errors=e,angular.element("#globalWarning").modal("show")})},e.contact_event=c.contact_event,e.change_contact_event=function(t){c.contact_event=t,e.contact_event=c.contact_event}}function verificationsController(e,t,n,a,i,o,r){function c(){e.Pages=[];var t,a,i=3;n.currentPage-3>=1?t=n.currentPage-3:(t=1,i=5-n.currentPage+4),n.currentPage+i<n.totalPages?a=n.currentPage+i:(a=n.totalPages,(t-=i)<1&&(t=1));for(var o=t;o<=a;o++)e.Pages.push(o);e.currentPage=n.currentPage,e.totalPages=n.totalPages,void 0}function s(){e.dropDownInds=angular.copy(a.dropDownInds),e.dropDownStatues=angular.copy(a.dropDownVerifications),e.dropDownMarkets=angular.copy(a.dropDownMarkets),e.dropDownUsers=angular.copy(a.dropDownUsers)}function l(){if(e.searchParams.ind_sub_segs){var t=[];angular.forEach(e.searchParams.ind_sub_segs,function(e){t.push(e.id)}),angular.forEach(e.dropDownInds,function(e){-1!=t.indexOf(e.id)&&(e.ticked=!0)})}if(e.searchParams.markets){var n=[];angular.forEach(e.searchParams.markets,function(e){n.push(e.market_id)}),angular.forEach(e.dropDownMarkets,function(e){-1!=n.indexOf(e.market_id)&&(e.ticked=!0)})}if(e.searchParams.statuses){var a=[];angular.forEach(e.searchParams.statuses,function(e){a.push(e.id)}),angular.forEach(e.dropDownStatues,function(e){-1!=a.indexOf(e.id)&&(e.ticked=!0)})}if(e.searchParams.users){var i=[];angular.forEach(e.searchParams.users,function(e){i.push(e.id)}),angular.forEach(e.dropDownUsers,function(e){-1!=i.indexOf(e.id)&&(e.ticked=!0)})}}i.group={},i.event={},i.contact={},i.verification={},o.contactFilter={},o.eventFilter={},r.tempContacts=null,e.clearFilters=function(){e.is_loading=!0,n.getVerifications().then(function(){e.is_loading=!1,e.events=n.verifications,e.searchParams={},o.verificationFilter=e.searchParams,s(),c(),e.sortFilter=""},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},e.followUpEdit=!1,e.openStatusChangeModal=function(t,n){e.verification_modal_event={},e.verification_modal_event={event:t,index:n},t.follow_up_date?e.followUpEdit=!0:e.followUpEdit=!1,angular.element("#statusNotes").modal("show")},e.updateList=function(){n.getVerificationById(e.verification_modal_event.event.verification_id).then(function(){e.verification_modal_event.event=n.verification,e.events[e.verification_modal_event.index]=e.verification_modal_event.event},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},e.popup1={opened:!1},e.open1=function(){e.popup1.opened=!0},e.popup2={opened:!1},e.open2=function(){e.popup2.opened=!0},e.changePage=function(t){t<1&&(t=1),t>e.totalPages&&(t=e.totalPages),e.filterList(t)},e.sortBy=function(t){e.sortFilter=t,e.filterList(e.currentPage)},e.filterList=function(a){e.is_loading=!0,n.getFilteredVerifications(angular.copy(e.searchParams),a,e.sortFilter).then(function(){o.verificationFilter=e.searchParams,e.events=n.verifications,e.is_loading=!1,l(),c()},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},e.setVerificationEvent=function(e){i.verification.event_name=e.event_name,i.event.event_name=e.event_name,i.verification.hotel_name=e.hotel_name,i.event.hotel_name=e.hotel_name,i.verification.event_hotel_id=e.hotel_id,i.event.event_hotel_id=e.hotel_id,i.verification.event_id=e.event_id,i.event.event_id=e.event_id,i.verification={status:e.status,event_id:e.hotel_id,hotel_name:e.hotel_name,event_name:e.event_name,assigned_user_id:e.assigned_user_id,verification_id:e.verification_id,start_date:e.start_date,end_date:e.end_date,follow_up_id:e.follow_up_id,follow_up_date:e.follow_up_date,follow_up_time:e.follow_up_time,follow_up_time_string:e.follow_up_time_string},i.group={group_id:e.group_id,group_name:e.group_name},i.saveToLocalStorage()},e.checkAll=function(){angular.forEach(e.events,function(e){e.Checked=!0})},e.uncheckAll=function(){angular.forEach(e.events,function(e){e.Checked=!1})},e.updateVerificationsStatus=function(a){var o=[];angular.forEach(e.events,function(e){!0===e.Checked&&o.push(e.verification_id)}),i.updateStatus(a.verification_status_id,o,null).then(function(){n.getVerifications().then(function(){e.events=n.verifications,c()},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},function(e){t.errors=e})},e.updateVerificationsAssignees=function(a){var o=[];angular.forEach(e.events,function(e){!0===e.Checked&&o.push(e.verification_id)}),i.updateAssignee(a,o).then(function(){n.getVerifications().then(function(){e.events=n.verifications,c()},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},e.updateVerificationAssignee=function(n,a,o){if(n){var r=[a.verification_id];e.is_loading=!0,i.updateAssignee(n,r).then(function(){e.is_loading=!1,e.events[o]=i.verification},function(n){e.is_loading=!1,t.errors=n,angular.element("#globalWarning").modal("show")})}},a.initializeReferences().then(function(){if(s(),e.Stats=a.verification_statuses,e.Users=a.data_core_users,!n.verifications||o.verificaitonsFlag)if(e.is_loading=!0,o.verificaitonsFlag)e.searchParams=o.verificationFilter,l(),e.filterList(e.currentPage);else{var t=[2,6,8];e.searchParams={statuses:[{id:2},{id:6},{id:8}],users:[{id:o.user_data.admin_user_id}]},angular.forEach(e.dropDownUsers,function(e){e.id===o.user_data.admin_user_id&&(e.ticked=!0)}),angular.forEach(e.dropDownStatues,function(e){-1!=t.indexOf(e.id)&&(e.ticked=!0)}),e.filterList(e.currentPage)}else e.searchParams=o.verificationFilter,l(),e.events=n.verifications,e.is_loading=!1,c()},function(e){t.errors=e,angular.element("#globalWarning").modal("show")});var u=(new Date).setHours(0,0,0,0);e.dateDiff=function(e){var t=new Date(e);t=t.getTime()+6e4*t.getTimezoneOffset();var n=Math.round((t-u)/864e5);return n<0?"Past Due":0==n?"Today":"in "+n+" days"},e.getFollowUps=function(){i.getFollowUps().then(function(){e.followups=i.followUps,e.follow_ups_today=[],angular.forEach(e.followups.pending,function(t){"Today"===e.dateDiff(t.follow_up_date)&&e.follow_ups_today.push(t)}),e.showFollowup=e.follow_ups_today.length>0},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},e.deleteFollowUp=function(n){i.deleteFollowUp(n).then(function(){e.getFollowUps(),e.filterList(e.currentPage)},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},e.getFollowUps(),e.dismissClick=function(){e.showFollowup=!1},e.isFollowup=!0,e.notificationOpen=!1,e.notificationClick=function(){e.user_data.admin_user_id||(e.user_data=o.user_data),e.notificationOpen=!e.notificationOpen},e.expandPending=!0,e.togglePending=function(){e.expandPending=!e.expandPending},e.expandUpcoming=!0,e.toggleUpcoming=function(){e.expandUpcoming=!e.expandUpcoming}}function addressListDirective(e,t,n,a,i,o,r){return{restrict:"AE",scope:{addresses:"=",canEdit:"=",updateView:"&"},replace:!0,templateUrl:"/_verifications/directives/addressList.html",link:function(r){function c(){var t=!1;n.event_data&&angular.forEach(n.event_data.event_contacts,function(e){e.contact_id==a.contact_id&&(t=!0)}),t&&n.getEventContactAddresses(n.event_data.event_contacts).then(function(){r.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})}r.updateAddress=function(n){n&&(a.contact_id?i.updateContactAddress(n,a.contact_id).then(function(){r.updateView(),c()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}):t.updateGroupAddress(n).then(function(){r.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}))},r.deleteAddress=function(n){n&&(a.contact_id?i.deleteContactAddress(n.address_id,a.contact_id).then(function(){i.getContactById(a.contact_id).then(function(){r.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}),c()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}):t.deleteGroupAddress(n.address_id).then(function(){r.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}))},r.sortType=["is_hq",";last_verified"],r.sortReverse=!0,o.initializeReferences().then(function(){r.states=o.states,r.countries=o.countries,r.address_types=o.address_types},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})}}}function contactDetailDirective(e,t,n,a,i,o,r,c,s){return{restrict:"AE",scope:{contact:"=",canEdit:"=",updateView:"&",updateHeader:"&",changeContactEvent:"&"},templateUrl:"/_verifications/controllers/contact.html",link:function(l){o.initializeContact(a.group_id,a.contact_id).then(function(){l.contact=o.contact_data,l.job_titles=r.job_titles,l.dnc_reasons=r.dnc_reasons,t.contact.contact_name=l.contact.contact_name,t.contact.contact_id=l.contact.contact_id,t.contact.contact_job_title=l.contact.contact_job_title,t.contact.addresses=l.addresses,l.updateHeader(),l.updateView(),l.is_loading=!1},function(t){e.errors=t,angular.element("#globalWarning").modal("show"),l.is_loading=!1}),l.showJobTitle=function(e){var t=s("filter")(l.job_titles,{job_title:e.contact_job_title});return t.length?t[0].job_title:e.job_title},l.updateContact=function(){o.updateContact(l.contact).then(function(){l.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show"),l.is_loading=!1})},l.getContactEvents=function(){var t={};t.contacts=[],t.contacts.push({contact_id:a.contact_id}),n.getFilteredEvents(a.group_id,t).then(function(){l.updateView(),l.changeContactEvent(!1),t.buttoned=!0,i.eventFilter=t,l.events=n.events},function(t){e.errors=t,angular.element("#globalWarning").modal("show"),l.is_loading=!1})},l.tabs=c.contactTabs,l.viewContactAddress=function(){c.contactTabs.email=!1,c.contactTabs.phone=!1,c.contactTabs.address=!0,l.tabs=c.contactTabs},l.viewContactPhone=function(){c.contactTabs.email=!1,c.contactTabs.phone=!0,c.contactTabs.address=!1,l.tabs=c.contactTabs},l.viewContactEmail=function(){c.contactTabs.email=!0,c.contactTabs.phone=!1,c.contactTabs.address=!1,l.tabs=c.contactTabs}}}}function contactDNCDirective(){return{restrict:"AE",scope:{contact:"=",dncReasons:"=",updateContact:"&",visible:"="},transclude:!0,replace:!0,templateUrl:"/_verifications/directives/contactDnc.html",link:function(e,t,n){e.validate=function(){},e.showForm=function(){e.validate(),e.formVisible=!0},e.hideForm=function(){e.formVisible=!1},e.submit=function(t){void 0,e.updateContact(e.contact),e.formVisible=!1}}}}function contactJobTitleDirective(){return{restrict:"AE",scope:{contact:"=",jobTitles:"=",updateContact:"&",visible:"="},transclude:!0,replace:!0,templateUrl:"/_verifications/directives/contactJobTitle.html",link:function(e,t,n){e.validate=function(){},e.showForm=function(){e.validate(),e.formVisible=!0},e.hideForm=function(){e.formVisible=!1},e.submit=function(t){e.updateContact(e.contact),e.formVisible=!1}}}}function contactListDirective(e,t,n,a,i,o,r,c){return{restrict:"AE",scope:{contacts:"=",canEdit:"=",updateView:"&",updateHeader:"&"},replace:!0,templateUrl:"/_verifications/directives/contactList.html",link:function(s){function l(){i.event_id&&(o.forceRefresh=!0,o.initializeEvent(a.group_data.group_id,o.event_data.event_id).then(function(){r.contactFilter.buttoned&&(a.contacts=o.event_data.event_contacts,s.contacts=o.event_data.event_contacts)},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})),r.contactFilter.filtered?(s.searchParams=r.contactFilter,s.filterList(s.currentPage)):r.contactFilter.buttoned||s.clearFilters()}function u(){c.event.event_id==o.event_data.event_id&&(o.forceRefresh=!0,o.initializeEvent(i.group_id,o.event_data.event_id).then(function(){s.updateView()},function(e){t.errors=e,angular.element("#globalWarning").modal("show")}))}function d(){2!=c.verification.status_id&&6!=c.verification.status_id||c.verification.event_id==c.event.event_id&&c.updateStatus(8,[c.verification.verification_id],null).then(function(){s.updateView(),s.updateHeader(),c.saveToLocalStorage()},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})}s.$watch("contacts",function(){s.group_id=a.group_data.group_id,s.searchParams=r.contactFilter,r.contactFilter.buttoned?s.Pages=[]:(s.currentPage=a.contactCurrentPage,s.totalPages=a.contactTotalPages)}),s.searchParams=r.contactFilter,s.getLink=function(t){"Group Events"===e.current.module?e.go("GroupDetail.contact",{group_id:a.group_data.group_id,contact_id:t.contact_id}):e.go("Detail.contact",{group_id:a.group_data.group_id,contact_id:t.contact_id})},s.sortBy=function(e){s.sortFilter=e,s.filterList(s.currentPage)},s.changePage=function(e){e<1&&(e=1),e>s.totalPages&&(e=s.totalPages),s.filterList(e)},s.sortType=["contact_name"],s.sortReverse=!1,s.checkContacts=function(){return s.contacts||(s.contacts=a.contacts),!s.contacts||0==s.contacts.length},s.DeleteContact=function(e){n.deleteContact(e).then(function(){s.clearIfActiveContact(e),l()},function(e){t.errors=e,angular.element("#globalWarning").modal("show"),s.is_loading=!1})},s.filterList=function(e){s.is_loading=!0,a.getFilteredContacts(i.group_id,s.searchParams,e,s.sortFilter).then(function(){s.contacts=a.contacts,r.contactFilter=s.searchParams,r.contactFilter.filtered=!0,r.contactFilter.buttoned=!1,s.is_loading=!1,s.currentPage=a.contactCurrentPage,s.totalPages=a.contactTotalPages},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},s.clearFilters=function(){s.is_loading=!0,s.searchParams={},a.getGroupContacts(i.group_id).then(function(){s.contacts=a.contacts,r.contactFilter={},r.contactFilter.filtered=!1,r.contactFilter.buttoned=!1,s.sortFilter="",s.is_loading=!1},function(e){t.errors=e,angular.element("#globalWarning").modal("show"),s.is_loading=!1})},s.associateEvent=function(e){o.associateContactWithEvent([c.event.event_id],[e]).then(function(){d(),u(),s.uncheckAll()},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},s.makeActiveContact=function(e){c.contact.contact_name=e.contact_name,c.contact.contact_id=e.contact_id,c.contact.contact_job_title=e.contact_job_title},s.clearIfActiveContact=function(t){i.contact_id==t&&a.getGroupContacts(a.group_data.group_id).then(function(){e.go("event",{group_id:a.group_data.group_id,event_id:c.verification.event_id})}),c.contact.contact_id===t&&(c.contact={},s.updateHeader())},s.associateAllContacts=function(){var e=[],t=[c.event.event_id];angular.forEach(s.contacts,function(t){t.Checked&&e.push(t.contact_id)}),o.associateContactWithEvent(t,e).then(function(){u(),s.uncheckAll(),d()},function(e){void 0})},s.checkFilters=function(){return r.contactFilter.filtered||r.contactFilter.buttoned},s.checkFilters2=function(){return r.contactFilter.filtered},s.checkFilters3=function(){return!r.contactFilter.filtered&&r.contactFilter.buttoned},s.checkAll=function(){angular.forEach(s.contacts,function(e){e.Checked=!0})},s.uncheckAll=function(){angular.forEach(s.contacts,function(e){e.Checked=!1})}}}}function emailListDirective(e,t,n,a,i){return{restrict:"AE",scope:{emails:"=",canEdit:"=",updateView:"&"},replace:!0,templateUrl:"/_verifications/directives/emailList.html",link:function(o){a.initializeReferences().then(function(){o.email_types=a.email_types}),o.updateEmail=function(a,r){angular.extend(a,{id:r});var c=i("filter")(o.emails,{email_id:r})[0];c&&t.updateContactEmail(c,n.contact_id).then(function(){o.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},o.deleteEmail=function(a){t.deleteContactEmail(a,n.contact_id).then(function(){t.getContactById(n.contact_id).then(function(){o.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},o.sortType=["is_hq",";last_verified"],o.sortReverse=!0}}}function eventDateDirective(e){return{restrict:"AE",scope:{event:"=",updateEvent:"&",visible:"=",changeLimit:"@",startLabel:"@",endLabel:"@"},transclude:!0,replace:!0,templateUrl:"/_verifications/directives/eventDate.html",link:{pre:function(e){e.start_date=new Date(e.event.start_date+"T00:00:00"),e.end_date=new Date(e.event.end_date+"T00:00:00"),e.dateOptions={showWeeks:!1,minDate:(new Date).setTime(e.start_date.getTime()-864e5*e.changeLimit),maxDate:(new Date).setTime(e.end_date.getTime()+864e5*e.changeLimit)},e.$watch("changeLimit",function(t){e.changeLimit=parseInt(t)})},post:function(t,n,a){t.start_date=new Date(t.event.start_date+"T00:00:00"),t.end_date=new Date(t.event.end_date+"T00:00:00"),t.showForm=function(){t.changeLimit,(new Date).setTime(t.start_date.getTime()-864e5*t.changeLimit),(new Date).setTime(t.end_date.getTime()+864e5*t.changeLimit),t.validate(),t.formVisible=!0},t.popupStartCal=function(){t.startCalPopup=!t.startCalPopup},t.popupEndCal=function(){t.endCalPopup=!t.endCalPopup},t.validate=function(){void 0},t.hideForm=function(){t.formVisible=!1},t.submit=function(n){t.event.start_date=e("date")(t.start_date,"yyyy-MM-dd"),t.event.end_date=e("date")(t.end_date,"yyyy-MM-dd"),t.updateEvent(),t.formVisible=!1},t.$watch("changeLimit",function(e){t.changeLimit=parseInt(e)})}}}}function eventDetailDirective(e,t,n,a,i,o,r,c,s,l){return{restrict:"AE",scope:{event:"=",canEdit:"=",updateView:"&",updateHeader:"&",changeContactEvent:"&"},replace:!0,templateUrl:"/_verifications/controllers/event.html",link:function(u){u.is_loading=!0,a.initializeEvent(r.group_id,r.event_id).then(function(){u.event=a.event_data,u.event_dc_ids=a.event_data.decision_criteria.map(function(e){return e.decision_type_id}),u.decision_types=o.decision_types,u.contactAddresses=a.eventContactAddress,u.channel_types=o.channel_types,u.RFP_Sources=o.RFP_sources,t.event.event_name=u.event.event_name,t.event.hotel_name=u.event.hotel_name,t.event.event_hotel_id=u.event.hotel_id,t.event.event_id=u.event.event_id,u.updateHeader(),u.updateView(),i.getHotelDetails(a.event_data.hotel_id).then(function(){u.rooms=i.rooms,u.is_loading=!1},function(t){e.errors=t,angular.element("#globalWarning").modal("show"),u.is_loading=!1})},function(t){e.errors=t,angular.element("#globalWarning").modal("show"),u.is_loading=!1}),u.setPlannedAddress=function(t){u.event.planned_address=t,a.setEventAddress(t.address_id,u.event.event_id).then(function(){u.searching=!1},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},u.setDataForUpdate=function(e,t,n){if(u.canEdit){var a=angular.copy(e);if(a.start_time&&a.end_time){var i=new Date(a.start_time);a.start_time=new Date(i.getTime()+60*i.getTimezoneOffset()*1e3);var o=new Date(a.end_time);a.end_time=new Date(o.getTime()+60*o.getTimezoneOffset()*1e3)}angular.forEach(u.rooms,function(t){for(var n=0;n<e.rooms.length;n++)t.room_id==e.rooms[n].room_id&&(t.ticked=!0,n+=e.rooms.length)}),u.eventFunctionData={date:t,ID:n,day_function:a,update:!0},angular.element("#createEventFunction").modal("show")}},u.setEventDayForEventFunctionCreate=function(e,t){u.eventFunctionData={date:e,ID:t},angular.forEach(u.rooms,function(e){e.ticked=!1})},u.fillEventDays=function(){var t=[],n=[];angular.forEach(u.event.event_days,function(e){n.push(e.event_day_date)});var i=new Date(u.event.end_date)-new Date(u.event.start_date);i=Math.round(i/864e5)+1;for(var o=new Date(u.event.start_date),r=0;r<i;r++)-1===n.indexOf(l("date")(new Date(o.getTime()+864e5*(r+1)),"yyyy-MM-dd"))&&t.push(l("date")(new Date(o.getTime()+864e5*(r+1)),"yyyy-MM-dd"));angular.forEach(t,function(t){a.createEventDay(t).then(function(){u.event=a.event_data},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})})},u.updateEvent=function(){u.event.decision_criteria=u.event_dc_ids,a.updateEventDetails(u.event).then(function(){u.event=a.event_data,u.autoUpdateStatus()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}),u.plannedDateFormVisible=!1},u.cancelUpdate=function(){u.plannedDateFormVisible=!1},u.showEventCriteria=function(){if(u.event){var e=[];return angular.forEach(u.decision_types,function(t){u.event_dc_ids.indexOf(t.decision_type_id)>=0&&e.push(t.decision_type)}),e.length?e.join(", "):""}},u.address_phone=s.address_list,u.change_address_phone=function(e){u.address_phone=s.list_templates[e]},u.showPlannedDateForm=function(){u.plannedDateFormVisible=!u.plannedDateFormVisible},u.setAssociateFlag=function(){c.associateFlag=!0},u.showEventContacts=function(){c.contactFilter.buttoned=!0,n.contacts=a.event_data.event_contacts,u.updateView(),u.changeContactEvent()},u.autoUpdateStatus=function(){8==t.verification.status_id&&t.verification.event_id==a.event_data.event_id&&t.updateStatus(3,[t.verification.verification_id],null).then(function(){u.updateView(),u.updateHeader()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})}}}}function eventListDirective(e,t,n,a,i,o,r){return{restrict:"AE",scope:{events:"=",canEdit:"=",updateView:"&",updateHeader:"&"},replace:!0,templateUrl:"/_verifications/directives/eventList.html",link:function(c){function s(e){c.dropDownData=[],angular.forEach(e,function(e,t){var n={contact_name:e.contact_name,contact_id:e.contact_id},a=!1;if(o.eventFilter.contacts)for(var i=0;i<o.eventFilter.contacts.length;i++)o.eventFilter.contacts[i].contact_id==e.contact_id&&(a=!0);n.ticked=a,c.dropDownData.push(n)})}function l(e){-1!=e.indexOf(i.event_data.event_id)&&(i.forceRefresh=!0,i.initializeEvent(n.group_id,i.event_data.event_id).then(function(){c.updateView()},function(e){}))}function u(){2!=r.verification.status_id&&6!=r.verification.status_id||r.updateStatus(8,[r.verification.verification_id],null).then(function(){c.updateView(),c.updateHeader(),r.saveToLocalStorage()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})}c.$watchCollection("events",function(){c.searchParams=o.eventFilter,c.currentPage=t.eventCurrentPage,c.totalPages=t.eventTotalPages,s(t.event_contacts)}),c.searchParams=o.eventFilter,c.currentPage=t.eventCurrentPage,c.sortBy=function(e){c.sortFilter=e,c.filterList(c.currentPage)},c.getLink=function(e){"Group Events"===a.current.module?a.go("GroupDetail.event",{group_id:e.group_id,event_id:e.event_id}):a.go("Detail.event",{group_id:e.group_id,event_id:e.event_id})},c.sortType=["start_date"],c.sortReverse=!0,c.popup1=!1,c.open1=function(){c.popup1=!0},c.popup2=!1,c.open2=function(){c.popup2=!0},t.group_data.event_contacts&&i.group_id===n.group_id?s(t.group_data.event_contacts):t.getGroupEventContacts(n.group_id).then(function(){s(t.event_contacts)},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}),c.clearFilters=function(){c.is_loading=!0,c.searchParams={},t.getGroupEventList(n.group_id).then(function(){c.events=t.events,o.eventFilter={},o.eventFilter.filtered=!1,o.eventFilter.buttoned=!1,c.is_loading=!1,c.sortFilter="",setPages()},function(t){e.errors=t,angular.element("#globalWarning").modal("show"),c.is_loading=!1}),angular.forEach(c.dropDownData,function(e){e.ticked=!1})},c.filterList=function(a){c.is_loading=!0,t.getFilteredEvents(n.group_id,angular.copy(c.searchParams),a,c.sortFilter).then(function(){c.events=t.events,o.eventFilter=c.searchParams,o.eventFilter.filtered=!0,o.eventFilter.buttoned=!1,c.is_loading=!1,c.currentPage=t.eventCurrentPage,c.totalPages=t.eventTotalPages},function(t){e.errors=t,angular.element("#globalWarning").modal("show"),c.is_loading=!1})},c.associateContact=function(t){c.is_loading=!0,i.associateContactWithEvent([t],[r.contact.contact_id]).then(function(){l([t]),u(),c.filterList(c.currentPage),c.is_loading=!1},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},c.makeActiveEvent=function(e){r.event.event_name=e.event_name,r.event.hotel_name=e.hotel_name,r.event.event_hotel_id=e.hotel_id,r.event.event_id=e.event_id},c.associateAllEvents=function(){c.is_loading=!0;var t=[r.contact.contact_id],n=[];angular.forEach(c.events,function(e){e.Checked&&n.push(e.event_id)}),i.associateContactWithEvent(n,t).then(function(){l(n),n.includes(r.verification.event_id)&&u(),c.filterList(c.currentPage),c.is_loading=!1},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},c.checkFilters=function(){return o.eventFilter.filtered||o.eventFilter.buttoned},c.checkFilters3=function(){return!o.eventFilter.filtered&&o.eventFilter.buttoned},c.checkAll=function(){angular.forEach(c.events,function(e,t){e.Checked=!0})},c.uncheckAll=function(){angular.forEach(c.events,function(e,t){e.Checked=!1})}}}}function groupDetailDirective(e,t,n,a,i){return{restrict:"AE",scope:{group:"=",canEdit:"=",updateView:"&",updateHeader:"&"},replace:!0,templateUrl:"/_verifications/controllers/group.html",link:function(o){o.is_loading=!0,n.initializeGroup(a.group_id).then(function(){o.group=n.group_data,e.group=n.group_data,o.updateHeader(),o.updateView(),o.is_loading=!1},function(e){t.errors=e,angular.element("#globalWarning").modal("show"),o.is_loading=!1}),o.updateGroup=function(){n.updateGroupDetails(o.group).then(function(){o.updateView()},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},o.tabs=i.groupTabs,o.viewGroupAddress=function(){i.groupTabs.phone=!1,i.groupTabs.address=!0,o.tabs=i.groupTabs},o.viewGroupPhone=function(){i.groupTabs.phone=!0,i.groupTabs.address=!1,o.tabs=i.groupTabs}}}}function industryDirective(e){return{restrict:"AE",scope:{group:"=",updateGroup:"&",visible:"=",segmentLabel:"@",subSegmentLabel:"@"},transclude:!0,replace:!0,templateUrl:"/_verifications/directives/industry.html",link:function(t,n,a){e.initializeReferences().then(function(){t.industry_segs=e.industry_segs,t.industry_sub_segs=e.industry_sub_segs},function(e){$rootScope.errors=e,angular.element("#globalWarning").modal("show")}),t.validate=function(){},t.showForm=function(){t.validate(),t.formVisible=!0},t.hideForm=function(){t.formVisible=!1},t.submit=function(e){void 0,t.updateGroup(),t.formVisible=!1}}}}function phoneListDirective(e,t,n,a,i,o){return{restrict:"AE",scope:{phones:"=",canEdit:"=",updateView:"&"},replace:!0,templateUrl:"/_verifications/directives/phoneList.html",link:function(r){i.initializeReferences().then(function(){r.phone_types={availableOptions:i.phone_types}}),r.updatePhone=function(i,c){angular.extend(i,{id:c});var s=o("filter")(r.phones,{phone_id:c})[0];s&&(a.contact_id?n.updateContactPhone(s,a.contact_id).then(function(){r.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}):t.updateGroupPhone(s).then(function(){r.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}))},r.deletePhone=function(i){a.contact_id?n.deleteContactPhone(i,a.contact_id).then(function(){n.getContactById(a.contact_id).then(function(){r.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}):t.deleteGroupPhone(i).then(function(){t.getGroupPhones(a.group_id).then(function(){r.updateView()})},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},r.sortType=["is_hq",";last_verified"],r.sortReverse=!0}}}function verificationListHeaderDirective(){return{restrict:"AE",scope:!1,replace:!0,templateUrl:"/_verifications/directives/verificationListHeader.html"}}function verificationWorkFlowDirective(e,t,n,a,i){return{restrict:"AE",scope:{verificationWorkFlow:"="},replace:!0,templateUrl:"/_verifications/directives/verificationWorkFlow.html",link:function(n){n.openModal=function(){angular.element("#statusNotes").modal("show")},n.goBack=function(){a.verificaitonsFlag=!0,e.go("verifications")};var i=(new Date).setHours(0,0,0,0);n.dateDiff=function(e){var t=new Date(e);return t=t.getTime()+6e4*t.getTimezoneOffset(),Math.round((t-i)/864e5)},t.verification.verification_id||(t.verification=t.getFromLocalStorage())}}}function contactSearchController(e,t,n,a,i,o){n.tempContacts?e.contacts=n.tempContacts:n.getTempContacts(t.group_id).then(function(){e.contacts=n.tempContacts},function(e){a.errors=e,angular.element("#globalWarning").modal("show")}),e.$on("Update Contact Search List",function(r){n.getTempContacts(t.group_id,i.contactFilter).then(function(){e.contacts=n.tempContacts,i.eventContactCreation&&(angular.forEach(e.contacts,function(e){e.contact_id==o.newcontact_id&&(e.Checked=!0)}),i.eventContactCreation=!1)},function(e){a.errors=e,angular.element("#globalWarning").modal("show")})}),e.filterList=function(i){n.getTempFilterContacts(t.group_id,i).then(function(){e.contacts=n.tempContacts},function(e){a.errors=e,angular.element("#globalWarning").modal("show")})},e.clearFilters=function(){n.getTempContacts(t.group_id).then(function(){e.contacts=n.tempContacts,e.searchParams={}},function(e){a.errors=e,angular.element("#globalWarning").modal("show")})},e.saveContacts=function(){var t=[];angular.forEach(e.contacts,function(e){e.Checked&&t.push(e)}),a.$broadcast("contacts Chosen",t)},e.setFlag=function(){i.eventContactCreation=!0,void 0}}function createAddressDirective(e,t,n,a,i){return{restrict:"AE",scope:{updateView:"&"},templateUrl:"/_verifications/modals/createAddress.html",link:function(o){function r(){var e=!1;a.event_data&&angular.forEach(a.event_data.event_contacts,function(n){n.contact_id==t.contact_id&&(e=!0)}),e&&a.getEventContactAddresses(a.event_data.event_contacts).then(function(){o.updateView()},function(e){$rootScope.errors=e,angular.element("#globalWarning").modal("show")})}e.initializeReferences().then(function(){o.states=e.states,o.countries=e.countries,o.address_types=e.address_types},function(e){$rootScope.errors=e,angular.element("#globalWarning").modal("show")}),o.addNewAddress=function(e){void 0,e.is_hq||(e.is_hq=!1),t.contact_id?n.postContactAddress(e,t.contact_id).then(function(){r(),o.updateView(),o.clearForm(),angular.element("#createAddress").modal("hide")},function(e){$rootScope.errors=e,angular.element("#globalWarning").modal("show")}):i.postGroupAddress(t.group_id,e).then(function(){o.updateView(),o.clearForm(),angular.element("#createAddress").modal("hide")},function(e){$rootScope.errors=e,angular.element("#globalWarning").modal("show")}),angular.element("#createAddress").modal("hide")},o.getHQ=function(){o.newAddress=i.getGroupHqAddress()},o.clearForm=function(){o.newAddress={}}}}}function createContactDirective(e,t,n,a,i,o,r){return{restrict:"AE",scope:{updateView:"&",updateHeader:"&"},replace:!0,templateUrl:"/_verifications/modals/createContact.html",link:function(c){function s(){r.verification.event_id==t.event_data.event_id&&r.updateStatus(8,[r.verification.verification_id],null).then(function(){c.updateHeader()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})}c.showPhone=!1,c.showEmail=!1,c.showAddress=!1,c.newcontactaddress={},i.initializeReferences().then(function(){c.states=i.states,c.countries=i.countries,c.address_types=i.address_types,c.job_titles=i.job_titles,c.salutations=i.salutations,c.email_types=i.email_types,c.phone_types=i.phone_types}),c.phoneSection=function(){c.showPhone=!c.showPhone,c.showPhone},c.emailSection=function(){c.showEmail=!c.showEmail},c.addressSection=function(){c.showAddress=!c.showAddress},c.getHQ=function(){c.newcontactaddress=n.getGroupHqAddress()},c.clearContactObject=function(){c.showPhone=!1,c.showEmail=!1,c.showAddress=!1,c.newcontactaddress={},c.newcontactemail={},c.newcontactphone={},c.newcontact={},o.associateFlag=!1},c.saveContact=function(i,r,l,u){c.showAddress||(u={}),
c.showEmail||(r=null),c.showPhone||(l=null),a.saveContact(i,r,l,u,o.associateFlag).then(function(){if(o.contactFilter={},n.getGroupContacts(n.group_data.group_id).then(function(){c.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}),o.associateFlag){var a=n.events.filter(function(e){return e.event_id==t.event_data.event_id}),i=n.events.indexOf(a[0]);n.events[i].event_contact_count+=1,t.forceRefresh=!0,s(),t.initializeEvent(n.group_data.group_id,t.event_data.event_id).then(function(){c.updateView()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})}c.clearContactObject(),o.associateFlag=!1,angular.element(".listSideModal #createContact").modal("hide"),angular.element("#createContact").modal("hide")},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}),angular.element(".listSideModal #createContact").modal("hide"),angular.element("#createContact").modal("hide")}}}}function createEmailDirective(e,t,n){return{restrict:"AE",scope:{updateView:"&"},replace:!0,templateUrl:"/_verifications/modals/createEmail.html",link:function(a){t.initializeReferences().then(function(){a.email_types=t.email_types}),a.saveNewEmail=function(t){t.is_hq||(t.is_hq=!1),e.postContactEmail(t,n.contact_id).then(function(){a.clearEmail(),a.updateView()},function(e){$rootScope.errors=e,angular.element("#globalWarning").modal("show")}),angular.element("#createEmail").modal("hide")},a.clearEmail=function(){a.newemail={}}}}}function createEventController(e,t,n,a,i,o,r,c){function s(){e.StuffForDropDown=c.EventCreateAddress,c.EventCreateAddress.length>0?(e.newevent.planned_address=c.EventCreateAddress[0].address,e.planned_contact_id=c.EventCreateAddress[0].contact_id,e.planned_contact_name=c.EventCreateAddress[0].contact_name):(e.newevent.planned_address=null,e.planned_contact_id=null,e.planned_contact_name=null)}e.popup1=!1,e.open1=function(){e.popup1=!0},e.popup2=!1,e.open2=function(){e.popup2=!0},e.popup3=!1,e.open3=function(){e.popup3=!0},e.popup4=!1,e.open4=function(){e.popup4=!0},e.pickHotel=!0,r.initializeReferences().then(function(){e.decision_criteria=r.decision_types},function(e){a.errors=e,angular.element("#globalWarning").modal("show")}),e.focus=!1,e.$on("contacts Chosen",function(t,n){c.EventCreateContacts=[],c.EventCreateAddress=[];for(var i=0;i<n.length;i++)c.getContactDetails(n[i].contact_id).then(function(){e.EventContacts=c.EventCreateContacts,s()},function(e){a.errors=e,angular.element("#globalWarning").modal("show")})}),e.setAsPlanned=function(t){e.newevent.planned_address=t.address,e.planned_contact_id=t.contact_id,e.planned_contact_name=t.contact_name,e.searching=!e.searching},e.fade=function(){t(function(){e.focus=!1},300)},e.setHotel=function(t){e.rooms=[],e.chosenHotel=t,o.getHotelDetails(t.hotel_id).then(function(){e.rooms=o.rooms,e.pickHotel=!1},function(e){a.errors=e,angular.element("#globalWarning").modal("show")}),e.focus=!1},e.$on("Hotel Chosen",function(t,n){e.setHotel(n)}),e.saveEvent=function(){e.newevent.hotel_id=e.chosenHotel.hotel_id,i.createNewEvent(angular.copy(e.newevent),e.EventContacts).then(function(){e.newevent=null},function(e){a.errors=e,angular.element("#globalWarning").modal("show")}),angular.element("#createEvent").modal("hide")},e.setUpEventDays=function(){var t=e.newevent.end_date-e.newevent.start_date;t=Math.round(t/864e5)+1,e.newevent.event_days=[];for(var a=0;a<t;a++)e.newevent.event_days.push({event_day_date:n("date")(new Date(e.newevent.start_date.getTime()+864e5*a),"yyyy-MM-dd"),day_functions:[]})},e.addEventFunction=function(e){e.push({selectableRooms:angular.copy(o.rooms)})},e.removeEventFunction=function(e,t){var n=e.indexOf(t);e.splice(n,1)},e.removeContact=function(t){var n=e.EventContacts.indexOf(t);c.removeFromEventCreateAddress(t.contact_id),e.EventContacts.splice(n,1),s()},e.autoComplete=function(){e.hotelName.length>2&&(e.loading=!0,o.getHotelList(e.hotelName).then(function(){e.Hotels=o.hotels,e.loading=!1},function(e){a.errors=e,angular.element("#globalWarning").modal("show")}))}}function createEventFunctionDirective(e,t){return{restrict:"AE",scope:{eventFunction:"=eventFunctionAttr",rooms:"=",updateView:"&",autoUpdateStatus:"&"},replace:!0,templateUrl:"/_verifications/modals/createEventFunction.html",link:function(n){n.saveEventFunction=function(){n.eventFunction.update?t.updateEventDayFunction(n.eventFunction.ID,n.eventFunction.day_function).then(function(){n.updateView(),n.autoUpdateStatus()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}):t.createEventDayFunction(n.eventFunction.ID,angular.copy(n.eventFunction.day_function)).then(function(){n.updateView(),n.autoUpdateStatus()},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}),angular.element("#createEventFunction").modal("hide")}}}}function createPhoneDirective(e,t,n,a,i){return{restrict:"AE",scope:{updateView:"&"},replace:!0,templateUrl:"/_verifications/modals/createPhone.html",link:function(o){a.initializeReferences().then(function(){o.phone_types={availableOptions:a.phone_types}}),o.newPhone=function(a){a.phone_type_id=o.phone_types.selectedOption.phone_type_id,a.is_hq||(a.is_hq=!1),e.contact_id?n.postContactPhone(a,e.contact_id).then(function(){o.updateView(),o.clearPhone()},function(e){i.errors=e,angular.element("#globalWarning").modal("show")}):t.postGroupPhone(a).then(function(){o.updateView(),o.clearPhone()},function(e){i.errors=e,angular.element("#globalWarning").modal("show")}),angular.element("#createPhone").modal("hide")},o.clearPhone=function(){o.newphone={}}}}}function groupEventAssociationDirective(e,t,n,a,i,o){return{restrict:"AE",replace:!0,scope:{eventData:"="},templateUrl:"/_verifications/modals/groupEventAssociation.html",link:function(r){function c(e){t.getGroupList(r.groupName,e,r.sort).then(function(){r.groupResults=t.groupList,r.currentPage=t.currentPage,r.totalPages=t.totalPages},function(e){a.errors=e,angular.element("#globalWarning").modal("show")})}r.GSsortType=["event_count",";group_name"],r.GSsortReverse=!0,r.isNewGroupCreation=!1,r.groupName_exists=!1,r.url_exists=!1,r.addressCheck=!1,r.isNewGroupCreationClick=function(){r.isNewGroupCreation=!r.isNewGroupCreation},i.initializeReferences().then(function(){r.industry_segs=i.industry_segs,r.industry_sub_segs=i.industry_sub_segs,r.countries=i.countries,r.states=i.states},function(e){a.errors=e,angular.element("#globalWarning").modal("show")}),r.groupResults=[],r.autoComplete=function(){r.groupName.length>2&&c(1)},r.checkGroupName=function(e){t.checkForGroup({keyword:e,keyword_type:"Name"}).then(function(){void 0,r.groupName_exists=t.check},function(e){a.errors=e,angular.element("#globalWarning").modal("show")})},r.checkGroupUrl=function(e){t.checkForGroup({keyword:e,keyword_type:"Url"}).then(function(){void 0,r.url_exists=t.check},function(e){a.errors=e,angular.element("#globalWarning").modal("show")})},r.sortResults=function(){r.sort=r.GSsortType+"_"+(!0===r.GSsortReverse?"desc":"asc").toString(),c(1)},r.matchIndustry=function(e){r.filtered_sub_segs=[],angular.forEach(r.industry_sub_segs,function(t){t.industry_seg_id===e&&r.filtered_sub_segs.push(t)})},r.checkAddress=function(e){t.checkAddress(e).then(function(){r.addressCheck=t.addressCheck},function(e){a.errors=e,angular.element("#globalWarning").modal("show")})},r.associateGroup=function(t,i,c){r.$parent.is_loading=!0,angular.element("#changeGroup").modal("hide"),n.changeGroup(c,t).then(function(){r.$parent.is_loading=!1,-1==t?"Verifications"===e.current.module?e.go("verifications-module"):e.go("group-events-module"):(o.group={group_id:t,group_name:i},"Verifications"===e.current.module?e.go("Detail.event",{group_id:t,event_id:n.event_data.event_id}):e.go("GroupDetail.event",{group_id:t,event_id:n.event_data.event_id}))},function(e){a.errors=e,angular.element("#globalWarning").modal("show")})},r.newGroup=function(e,i){r.$parent.is_loading=!0,t.postNewGroup(e,i).then(function(){r.associateGroup(t.new_group_data.group_id,t.new_group_data.group_name,n.event_data.event_id)},function(e){a.errors={errors:e},angular.element("#globalWarning").modal("show")})}}}}function propertySearchController(e,t,n,a){function i(){e.dropDownBrands=a.dropDownBrands,e.dropDownMarkets=a.dropDownMarkets}function o(){e.stateDropDown=angular.copy(a.Hotel_State_DropDown)}e.headerOpen=!0,a.initializeReferences().then(function(){i()},function(e){t.errors=e,angular.element("#globalWarning").modal("show")}),a.getHotelState().then(function(){o()},function(e){t.errors=e,angular.element("#globalWarning").modal("show")}),e.getHotels=function(a){n.searchAllHotels(a).then(function(){e.properties=n.hotels,e.headerOpen=!1},function(e){t.errors=e,angular.element("#globalWarning").modal("show")})},e.clearFilters=function(){e.searchParams={},e.properties={},i(),e.stateDropDown=[],o()},e.chooseHotel=function(e){t.$broadcast("Hotel Chosen",e)}}function statusNotesDirective(e,t,n){return{restrict:"AE",replace:!0,scope:{verification:"=",updateView:"&",refreshFollowUps:"&",editFollowUp:"="},templateUrl:"/_verifications/modals/statusNotes.html",link:function(a){a.updateNoteStatusList=function(){t.getVerificationNotes(a.verification.verification_id).then(function(){a.verificationNotes=t.notes,a.scheduleFollowUp=!1},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},a.isTerminalState=!1,a.$watch("verification",function(){if(a.Users||(a.Users=n.data_core_users),a.verification)if(a.notesOnly=1!==a.verification.status_id,a.isTerminalState=3==a.verification.status_id||9==a.verification.status_id||5==a.verification.status_id||4==a.verification.status_id,a.availableStatuses=n.verification_statuses.filter(function(e){return 6==e.verification_status_id||4==e.verification_status_id||9==e.verification_status_id||5==e.verification_status_id}),6==a.verification.status_id&&(a.availableStatuses=a.availableStatuses.filter(function(e){return 4==e.verification_status_id||9==e.verification_status_id||5==e.verification_status_id})),8==a.verification.status_id&&(a.availableStatuses=a.availableStatuses.filter(function(e){return 4==e.verification_status_id||5==e.verification_status_id})),a.updateNoteStatusList(),a.editFollowUp){var e=new Date(a.verification.follow_up_date);e=e.getTime()+6e4*e.getTimezoneOffset(),a.followup_date=e,a.followup_time=(new Date).setHours(0,0,0,0)+6e4*a.verification.follow_up_time,a.scheduleFollowUpTrue()}else a.followup_date=new Date,a.followup_time=null,a.scheduleFollowUpTrue()}),a.notesOnly=!0,a.notesOnlyClick=function(){a.notesOnly=!a.notesOnly},a.notesTime=function(){a.notesOnly=!0},a.statusTime=function(){a.notesOnly=!1},a.scheduleFollowUpTrue=function(){a.scheduleFollowUp=!0},a.scheduleFollowUpFalse=function(){a.scheduleFollowUp=!1},a.setStatus=function(n,i){a.is_loading=!0,n=5==n?function(){return 6==a.verification.status_id||2==a.verification.status_id?9:4}():n,t.updateStatus(n,[a.verification.verification_id],i).then(function(){a.new_note=null,a.is_loading=!1},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},a.saveNote=function(n,i){a.is_loading=!0,t.createNewVerificationNote(a.verification.verification_id,n,i).then(function(){i?(6==a.verification.status_id&&(a.verification.contact_attempts+=1),8==a.verification.status_id&&(a.verification.event_attempts+=1),a.scheduleFollowUpTrue()):(angular.element("#statusNotes").modal("hide"),a.updateNoteStatusList()),i&&2==a.verification.status_id&&a.setStatus(6),i&&8==a.verification.status_id&&a.verification.event_attempts>2&&a.setStatus(4,"Exceeded Attempts"),i&&6==a.verification.status_id&&a.verification.contact_attempts>4&&a.setStatus(9,"Exceeded Attempts"),a.new_note=null,a.is_loading=!1},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},a.saveFollowUp=function(n,i){var o=null;if(i){i=new Date(i);var r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);o=(i.getTime()-r.getTime())/6e4}void 0,isNaN(n)||(n=new Date(n));var c={follow_up_time:o,follow_up_date:n};a.editFollowUp?t.updateFollowUp(a.verification.follow_up_id,c).then(function(){a.scheduleFollowUp=!1,a.updateView(),a.refreshFollowUps(),angular.element("#statusNotes").modal("hide")},function(t){e.errors=t,angular.element("#globalWarning").modal("show")}):t.createNewFollowUp(a.verification.verification_id,c).then(function(){a.scheduleFollowUp=!1,a.updateNoteStatusList(),a.updateView(),a.refreshFollowUps(),angular.element("#statusNotes").modal("hide")},function(t){e.errors=t,angular.element("#globalWarning").modal("show")})},a.verificationNotes=[]}}}function verificationService(e,t,n){function a(e){var t=new Date(e);return t=t.getTime()+6e4*t.getTimezoneOffset()}var i=this;i.getVerifications=function(){return t(function(t,n){e.get("/verification").then(function(e){i.verifications=e.data.verifications,i.totalPages=e.data.total_pages,i.currentPage=e.data.current_page,t()},function(e){n(e.data)})})},i.getVerificationsByIds=function(n){return t(function(t,a){e.get("/verification",JSON.stringify(n)).then(function(e){i.verifications_data=e.data.verifications,t()},function(e){a(e.data)})})},i.getMarketAssignments=function(){return t(function(t,n){e.get("/verification/assignments").then(function(e){i.assignments=e.data.market_assignments.markets,i.total_90_events=e.data.market_assignments.total_90_day_events,i.total_completions=e.data.market_assignments.total_completions,i.total_verification_share=e.data.market_assignments.total_verification_share,i.total_weight=e.data.market_assignments.total_weight,t()},function(e){n(e.data)})})},i.getUserQuotas=function(){return t(function(t,n){e.get("/verification/quotas").then(function(e){i.quotas=e.data.verification_quotas,t()},function(e){n(e.data)})})},i.updateUserQuota=function(n,a){var o={user_id:n,quota:a};return t(function(t,n){e.put("/verification/quotas",o).then(function(e){i.quotas=e.data.verification_quotas,void 0,t()},function(e){n(e.data)})})},i.updateMarketAssignment=function(n){return 1!==n.market_tier_id&&(n.is_XL=!1),t(function(t,a){e.put("/verification/market_assignment",n).then(function(e){i.market_assignment=e.data.market_assignment.market,i.total_weight=e.data.market_assignment.total_weight,t()},function(e){a(e.data)})})},i.updateAllMarketAssignment=function(n){return t(function(t,a){e.put("/verification/market_assignments",n).then(function(e){i.assignments=e.data.market_assignments.markets,i.total_90_events=e.data.market_assignments.total_90_day_events,i.total_completions=e.data.market_assignments.total_completions,i.total_verification_share=e.data.market_assignments.total_verification_share,i.total_weight=e.data.market_assignments.total_weight,t()},function(e){a(e.data)})})},i.updateAllMarketWeights=function(n){return t(function(t,a){e.put("/verification/market_weights",n).then(function(e){i.assignments=e.data.market_assignments.markets,i.total_90_events=e.data.market_assignments.total_90_day_events,i.total_completions=e.data.market_assignments.total_completions,i.total_verification_share=e.data.market_assignments.total_verification_share,i.total_weight=e.data.market_assignments.total_weight,t()},function(e){a(e.data)})})},i.getVerificationDeployment=function(){return t(function(t,n){e.get("/verification/deployment").then(function(e){i.verification_deployment=e.data.verification_deployment,t()},function(e){n(e.data)})})},i.getFilteredVerifications=function(o,r,c){(o.start_date||o.end_date)&&(o.start_date=n("date")(new Date(o.start_date),"yyyy-MM-dd"),o.end_date=n("date")(new Date(o.end_date),"yyyy-MM-dd"));var s="",l="",u="",d="";return angular.forEach(o.ind_sub_segs,function(e){s+=","+e.id}),angular.forEach(o.statuses,function(e){l+=","+e.id}),angular.forEach(o.users,function(e){u+=","+e.id}),angular.forEach(o.markets,function(e){d+=","+e.market_id}),t(function(t,n){e.get("/verification?"+(o.assigned_users?"&assigned_users="+o.assigned_users:"")+(o.event_name?"&event_name="+o.event_name:"")+(o.hotel_name?"&hotel_name="+o.hotel_name:"")+(""===l?"":"&status_ids="+l)+(""===s?"":"&ind_sub_segs="+s)+(""===u?"":"&assigned_users="+u)+(""===d?"":"&market_ids="+d)+(o.start_date?"&start_date="+o.start_date:"")+(o.end_date?"&end_date="+o.end_date:"")+(r?"&page_number="+r:"")+(c?"&sort_by="+c:"")).then(function(e){i.verifications=e.data.verifications,angular.forEach(i.verifications,function(e){e.follow_up_id&&(e.follow_up_date=a(e.follow_up_date))}),i.totalPages=e.data.total_pages,i.currentPage=e.data.current_page,t()},function(e){n(e.data)})})},i.getVerificationById=function(n){return t(function(t,a){e.get("/verification/"+n).then(function(e){i.verification=e.data.verification,t()},function(e){a(e.data)})})}}verificationService.$inject=["$http","$q","$filter"],verificationsController.$inject=["$scope","$rootScope","verification","reference","verificationWorkFlow","user","group"],verificationDetailController.$inject=["$scope","reference","contact","user","event","group","verificationWorkFlow","tabs"],contactSearchController.$inject=["$scope","$stateParams","group","$rootScope","user","contact"],createEventController.$inject=["$scope","$timeout","$filter","$rootScope","event","hotel","reference","contact"],propertySearchController.$inject=["$scope","$rootScope","hotel","reference"],verificationWorkFlowDirective.$inject=["$state","verificationWorkFlow","reference","user","$rootScope"],createPhoneDirective.$inject=["$stateParams","group","contact","reference","$rootScope"],phoneListDirective.$inject=["$rootScope","group","contact","$stateParams","reference","$filter"],createAddressDirective.$inject=["reference","$stateParams","contact","event","group"],addressListDirective.$inject=["$rootScope","group","event","$stateParams","contact","reference","$filter"],createEmailDirective.$inject=["contact","reference","$stateParams"],emailListDirective.$inject=["$rootScope","contact","$stateParams","reference","$filter"],createContactDirective.$inject=["$rootScope","event","group","contact","reference","user","verificationWorkFlow"],createEventFunctionDirective.$inject=["$rootScope","event"],contactListDirective.$inject=["$state","$rootScope","contact","group","$stateParams","event","user","verificationWorkFlow"],eventListDirective.$inject=["$rootScope","group","$stateParams","$state","event","user","verificationWorkFlow"],industryDirective.$inject=["reference"],eventDateDirective.$inject=["$filter"],statusNotesDirective.$inject=["$rootScope","verificationWorkFlow","reference"],groupEventAssociationDirective.$inject=["$state","group","event","$rootScope","reference","verificationWorkFlow"],contactDetailDirective.$inject=["$rootScope","verificationWorkFlow","group","$stateParams","user","contact","reference","tabs","$filter"],eventDetailDirective.$inject=["$rootScope","verificationWorkFlow","group","event","hotel","reference","$stateParams","user","tabs","$filter"],groupDetailDirective.$inject=["verificationWorkFlow","$rootScope","group","$stateParams","tabs"],angular.module("verifications-app",["data-core-app"]).service("tabs",tabsService).service("verification",verificationService).service("verificationWorkFlow",verificationWorkFlowService).controller("verificationsController",verificationsController).controller("verificationDetailController",verificationDetailController).controller("contactSearchController",contactSearchController).controller("createEventController",createEventController).controller("propertySearchController",propertySearchController).directive("verificationHeader",verificationWorkFlowDirective).directive("createPhone",createPhoneDirective).directive("phoneList",phoneListDirective).directive("createAddress",createAddressDirective).directive("addressList",addressListDirective).directive("createEmail",createEmailDirective).directive("emailList",emailListDirective).directive("createContact",createContactDirective).directive("createEventFunction",createEventFunctionDirective).directive("contactList",contactListDirective).directive("eventList",eventListDirective).directive("industrySegment",industryDirective).directive("eventDate",eventDateDirective).directive("addressEditForm",addressDirective).directive("contactName",contactNameDirective).directive("contactJobTitle",contactJobTitleDirective).directive("contactDnc",contactDNCDirective).directive("statusNotes",statusNotesDirective).directive("groupEventAssociation",groupEventAssociationDirective).directive("verificationListHeader",verificationListHeaderDirective).directive("contactDetail",contactDetailDirective).directive("eventDetail",eventDetailDirective).directive("groupDetail",groupDetailDirective),angular.module("verifications-app").config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,t,n){e.state("verifications",{url:"/",templateUrl:"/_verifications/controllers/verifications.html",controller:"verificationsController",module:"Verifications"}).state("Detail",{abstract:!0,url:"/detail",templateUrl:"/_verifications/controllers/verificationDetail.html",controller:"verificationDetailController",module:"Verifications"}).state("Detail.group",{url:"/group/:group_id",template:'<div group-detail group="group" update-view="updateView()" update-header="updateHeader()" can-edit="canEdit"></div>',module:"Verifications"}).state("Detail.contact",{url:"/group/:group_id/contact/:contact_id",template:'<div contact-detail contact="contact" update-view="updateView()" update-header="updateHeader()" change-contact-event="change_contact_event(false)" can-edit="canEdit"></div>',module:"Verifications"}).state("Detail.event",{url:"/group/:group_id/event/:event_id",template:'<div event-detail event="event" update-view="updateView()" update-header="updateHeader()" change-contact-event="change_contact_event(true)" can-edit="canEdit"></div>',module:"Verifications"}),t.otherwise("/"),n.interceptors.push("httpInterceptor")}]).run(function(){void 0});